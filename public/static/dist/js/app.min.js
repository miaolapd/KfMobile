!function i(r,l,s){function c(t,e){if(!l[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=l[t]={exports:{}};r[t][0].call(o.exports,function(e){return c(r[t][1][e]||e)},o,o.exports,i,r,l,s)}return l[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)c(s[e]);return c}({1:[function(t,e,n){"use strict";var a,o=t("./module/config"),i=(f(t("./module/util")),t("./module/const")),r=((a=i)&&a.__esModule,f(t("./module/msg")),f(t("./module/dialog")),f(t("./module/script"))),l=f(t("./module/public")),s=f(t("./module/index")),c=f(t("./module/read")),d=f(t("./module/post")),u=f(t("./module/other"));f(t("./module/configDialog"));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}window.pageId=$("body").attr("id");$(document).ready(function(){if("loginPage"!==pageId){var e=new Date;!function(){try{window.Util=t("./module/util"),window.Const=t("./module/const").default,window.Msg=t("./module/msg"),window.Dialog=t("./module/dialog"),window.Script=t("./module/script"),window.Public=t("./module/public"),window.Index=t("./module/index"),window.Read=t("./module/read"),window.Post=t("./module/post"),window.Other=t("./module/other");var e=t("./module/config");window.readConfig=e.read,window.writeConfig=e.write}catch(e){console.log(e)}}(),"registerPage"!==pageId?((0,o.init)(),Config.customCssEnabled&&Config.customCssContent&&$("head").append("<style>"+Config.customCssContent+"</style>"),Config.customScriptEnabled&&r.runCustomScript("start"),l.preventCloseWindow(),l.handleMainMenu(),l.handleMainMenuLink(),Config.showSidebarBtnGroupEnabled&&l.showSidebarBtnGroup(),l.handleSidebarRollBtn(),l.handleSearchDialog(),l.fillCommonForumPanel(),l.showEditCommonForumDialog(),0<$(".page-input").length&&l.handlePageInput(),l.bindFastSubmitShortcutKey(),"indexPage"===pageId?(s.handleAtTipsBtn(),s.handleIndexThreadPanel(),s.handleSelectBg()):"readPage"===pageId?(c.gotoFloor(),0<Config.threadContentFontSize&&$("head").append("<style>.read-content { font-size: "+Config.threadContentFontSize+"px; }</style>"),c.handleFastGotoFloorBtn(),c.handleTuiThreadBtn(),c.handleCopyFloorLinkBtn(),c.handleFastReplyBtn(),c.handleGoodPostBtn(),c.handleBlockFloorBtn(),c.handleBuyThreadBtn(),c.copyBuyThreadList(),c.replaceAttachLabel(),c.handleFloorImage(),d.checkPostForm(),c.handleCopyCodeBtn(),d.addSmileCode($("#postContent")),d.addRedundantKeywordWarning(),c.bindMultiQuoteCheckClick(),d.handleClearMultiQuoteDataBtn(),c.handleMoveThreadBtn(),$(".multi-reply-btn").click(function(){return d.handleMultiQuote(1)}),Config.userMemoEnabled&&c.addUserMemo(),r.handleInstallScriptLink()):"postPage"===pageId?(d.addRedundantKeywordWarning(),d.checkPostForm(),d.handleEditorBtns(),d.addSmileCode($("#postContent")),d.handleAttachBtns(),d.handleClearMultiQuoteDataBtn(),Info.multiQuote&&d.handleMultiQuote(2),$("#postTitleFormatArea").on("change",'[type="text"], [type="checkbox"]',function(){return d.specialPostTitleChange()})):"gjcPage"===pageId?u.highlightUnReadAtTipsMsg():"userPage"===pageId?(u.handleUserPageBtns(),u.handleProfilePage()):"gameIntroSearchPage"===pageId?u.handleGameIntroSearchArea():["gameIntroPage","gameIntroCompanyPage","gameIntroTypePage","gameIntroPropertyPage"].includes(pageId)?u.tuiGame():"favorPage"===pageId?u.bindFavorPageBtnsClick():"friendPage"===pageId?u.bindFriendPageBtnsClick():"modifyPage"===pageId?(u.syncPerPageFloorNum(),u.assignBirthdayField(),u.handleUploadAvatarFileBtn()):"bankPage"===pageId?u.transferKfbAlert():"messagePage"===pageId?u.bindMessageActionBtnsClick():"readMessagePage"===pageId?(c.handleFloorImage(),c.handleCopyCodeBtn()):"writeMessagePage"===pageId?d.addSmileCode($("#msgContent")):"selfRateRatingPage"===pageId?u.showSelfRateErrorSizeSubmitWarning():"haloPage"===pageId?$("#buyHaloBtns").on("click","a",function(){if(!confirm("是否"+$(this).text().trim()+"提升一次战力光环？"))return!1;localStorage.removeItem("pd_tmp_log_"+Info.uid)}):"itemShopPage"===pageId&&(u.handleBuyItemBtns(),u.showMyInfoInItemShop()),Config.blockUserEnabled&&l.blockUsers(),Config.blockThreadEnabled&&l.blockThread(),Config.followUserEnabled&&l.followUsers(),Config.kfSmileEnhanceExtensionEnabled&&["readPage","postPage","writeMessagePage"].includes(pageId)&&$("body").append('<script src="'+Info.rootPath+Info.staticPath+"js/userScript/KfEmotion.min.user.js?ts="+Info.resTimestamp+'"><\/script>'),Config.adminMemberEnabled&&$('a[data-not-click="true"]').removeClass("not-click-link"),location.host.endsWith(".miaola.info")&&$(".change-domain-tips").show(),Config.customScriptEnabled&&r.runCustomScript("end"),$('[data-toggle="tooltip"]').tooltip({container:"body"}),console.log("脚本加载完毕，耗时："+(new Date-e)+"ms")):u.handleRegisterPage()}})},{"./module/config":2,"./module/configDialog":3,"./module/const":4,"./module/dialog":5,"./module/index":6,"./module/msg":7,"./module/other":8,"./module/post":9,"./module/public":10,"./module/read":11,"./module/script":12,"./module/util":13}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.normalize=n.clear=n.write=n.read=n.init=n.Config=void 0;var d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./util"));var o="kf_config",u=n.Config={activeNewReplyPanel:"#newReplyPanel1",activeNewPublishPanel:"#newPublishPanel1",activeNewExtraPanel:"#newExtraPanel1",commonForumList:[],showSidebarBtnGroupEnabled:!0,showSidebarRollBtnEnabled:!0,showSidebarMainMenuBtnEnabled:!1,showSidebarForumListBtnEnabled:!0,showSidebarSearchBtnEnabled:!1,showSidebarHomePageBtnEnabled:!0,perPageFloorNum:10,threadContentFontSize:0,userMemoEnabled:!1,userMemoList:{},kfSmileEnhanceExtensionEnabled:!1,defShowMsgDuration:-1,customCssEnabled:!1,customCssContent:"",customScriptEnabled:!1,customScriptList:[],adminMemberEnabled:!1,followUserEnabled:!1,followUserList:[],highlightFollowUserThreadInHPEnabled:!0,highlightFollowUserThreadLinkEnabled:!0,blockUserEnabled:!1,blockUserDefaultType:0,blockUserAtTipsEnabled:!0,blockUserForumType:0,blockUserFidList:[],blockUserList:[],blockThreadEnabled:!1,blockThreadDefForumType:0,blockThreadDefFidList:[],blockThreadList:[]},i=(n.init=function(){window.Config=$.extend(!0,{},u),i()},n.read=function(){var e=localStorage[o];if(e){try{e=JSON.parse(e)}catch(e){return}e&&"object"===$.type(e)&&!$.isEmptyObject(e)&&(e=r(e),window.Config=$.extend(!0,{},u,e))}}),r=(n.write=function(){var e=a.getDifferenceSetOfObject(u,window.Config);localStorage[o]=JSON.stringify(e)},n.clear=function(){localStorage.removeItem(o)},n.normalize=function(e){var t={};if("object"!==$.type(e))return t;var n=!0,a=!1,o=void 0;try{for(var i,r=Object.entries(e)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=d(i.value,2),s=l[0],c=l[1];s in u&&$.type(c)===$.type(u[s])&&(t[s]=c)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return t})},{"./util":13}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.show=void 0;var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_util=require("./util"),Util=_interopRequireWildcard(_util),_const=require("./const"),_const2=_interopRequireDefault(_const),_dialog=require("./dialog"),Dialog=_interopRequireWildcard(_dialog),_config=require("./config"),_script=require("./script"),Script=_interopRequireWildcard(_script),_public=require("./public"),Public=_interopRequireWildcard(_public);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var show=exports.show=function(){var n="configDialog";if(!(0<$("#"+n).length)){(0,_config.read)();var a=Dialog.create(n,"助手设置",'\n<div class="btn-group-sm text-right mb-1">\n  <a class="btn btn-link text-danger" data-name="clearTmpData" href="#">清除临时数据</a>\n  <a class="btn btn-link" data-name="openRunCommandDialog" href="#">运行命令</a>\n</div>\n<fieldset class="fieldset mb-3 py-2">\n  <legend class="form-check">\n    <input class="form-check-input" id="configDialog_showSidebarBtnGroupEnabled" name="showSidebarBtnGroupEnabled" type="checkbox">\n    <label class="form-check-label" for="configDialog_showSidebarBtnGroupEnabled">显示侧边栏按钮组</label>\n    <span class="tips" data-toggle="tooltip" title="显示侧边栏按钮组，可在下方设置要显示的按钮">[?]</span>\n  </legend>\n  \n  <div class="mb-2 d-sm-inline-block">\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" id="configDialog_showSidebarRollBtnEnabled" name="showSidebarRollBtnEnabled" type="checkbox">\n      <label class="form-check-label" for="configDialog_showSidebarRollBtnEnabled">滚动到页顶/页底</label>\n    </div>\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" id="configDialog_showSidebarMainMenuBtnEnabled" name="showSidebarMainMenuBtnEnabled" type="checkbox">\n      <label class="form-check-label" for="configDialog_showSidebarMainMenuBtnEnabled">主菜单</label>\n    </div>\n  </div>\n  \n  <div class="mb-2 d-sm-inline-block">\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" id="configDialog_showSidebarForumListBtnEnabled" name="showSidebarForumListBtnEnabled" type="checkbox">\n      <label class="form-check-label" for="configDialog_showSidebarForumListBtnEnabled">版块列表</label>\n    </div>\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" id="configDialog_showSidebarSearchBtnEnabled" name="showSidebarSearchBtnEnabled" type="checkbox">\n      <label class="form-check-label" for="configDialog_showSidebarSearchBtnEnabled">搜索</label>\n    </div>\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" id="configDialog_showSidebarHomePageBtnEnabled" name="showSidebarHomePageBtnEnabled" type="checkbox">\n      <label class="form-check-label" for="configDialog_showSidebarHomePageBtnEnabled">首页</label>\n    </div>\n  </div>\n</fieldset>\n\n<fieldset class="fieldset mb-3 py-2">\n  <legend>主题页面相关</legend>\n  \n  <div class="form-group mb-2">\n    <label for="perPageFloorNum">主题每页楼层数量</label>\n    <select class="custom-select custom-select-sm w-auto" id="perPageFloorNum" name="perPageFloorNum">\n      <option value="10">10</option><option value="20">20</option><option value="30">30</option>\n    </select>\n    <span class="tips" data-toggle="tooltip" title="主题页面中每页的楼层数量（用于电梯直达等功能），如果修改了论坛设置里的“文章列表每页个数”，请在此修改成相同的数目">[?]</span>\n  </div>\n  \n  <div class="input-group mb-2">\n    <div class="input-group-prepend">\n      <span class="input-group-text">主题内容字体大小</span>\n    </div>\n    <input class="form-control" name="threadContentFontSize" data-toggle="tooltip" type="number" min="8" max="72"\n           title="主题内容字体大小，留空表示使用默认大小，默认值：14px">\n    <div class="input-group-append">\n      <span class="input-group-text">px</span>\n    </div>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_userMemoEnabled" name="userMemoEnabled" type="checkbox" data-disabled="[data-name=openUserMemoDialog]">\n    <label class="form-check-label" for="configDialog_userMemoEnabled">显示用户备注</label>\n    <span class="tips" data-toggle="tooltip" title="在楼层内的用户名旁显示该用户的自定义备注">[?]</span>\n    <a class="ml-3" data-name="openUserMemoDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_kfSmileEnhanceExtensionEnabled" name="kfSmileEnhanceExtensionEnabled" type="checkbox">\n    <label class="form-check-label" for="configDialog_kfSmileEnhanceExtensionEnabled">开启绯月表情增强插件</label>\n    <span class="tips" data-toggle="tooltip" title="在发帖框上显示绯月表情增强插件，该插件由eddie32开发">[?]</span>\n  </div>\n</fieldset>\n\n<fieldset class="fieldset mb-3 py-2">\n  <legend>其它设置</legend>\n  \n  <div class="input-group mb-2">\n    <div class="input-group-prepend">\n      <span class="input-group-text">消息显示时间</span>\n    </div>\n    <input class="form-control" name="defShowMsgDuration" data-toggle="tooltip" type="number" min="-1" required\n           title="默认的消息显示时间（秒），设置为-1表示永久显示，例：15">\n    <div class="input-group-append">\n      <span class="input-group-text">秒</span>\n    </div>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_customCssEnabled" name="customCssEnabled" type="checkbox" data-disabled="[data-name=openCustomCssDialog]">\n    <label class="form-check-label" for="configDialog_customCssEnabled">添加自定义CSS</label>\n    <span class="tips" data-toggle="tooltip" title="为页面添加自定义的CSS内容，请点击详细设置填写自定义的CSS内容">[?]</span>\n    <a class="ml-3" data-name="openCustomCssDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_customScriptEnabled" name="customScriptEnabled" type="checkbox" data-disabled="[data-name=openCustomScriptDialog]">\n    <label class="form-check-label" for="configDialog_customScriptEnabled">执行自定义脚本</label>\n    <span class="tips" data-toggle="tooltip" title="执行自定义的javascript脚本，请点击详细设置填入自定义脚本内容">[?]</span>\n    <a class="ml-3" data-name="openCustomScriptDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_adminMemberEnabled" name="adminMemberEnabled" type="checkbox">\n    <label class="form-check-label" for="configDialog_adminMemberEnabled">我是管理成员</label>\n    <span class="tips" data-toggle="tooltip" title="管理成员可开启此功能，助手会开启部分只有管理成员才能使用的功能，非管理成员开启此功能无效">[?]</span>\n  </div>\n</fieldset>\n\n<fieldset class="fieldset mb-3 py-2">\n  <legend>关注和屏蔽</legend>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_followUserEnabled" name="followUserEnabled" type="checkbox" data-disabled="[data-name=openFollowUserDialog]">\n    <label class="form-check-label" for="configDialog_followUserEnabled">关注用户</label>\n    <span class="tips" data-toggle="tooltip" title="开启关注用户的功能，所关注的用户将被加注记号，请点击详细设置管理关注用户">[?]</span>\n    <a class="ml-3" data-name="openFollowUserDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_blockUserEnabled" name="blockUserEnabled" type="checkbox" data-disabled="[data-name=openBlockUserDialog]">\n    <label class="form-check-label" for="configDialog_blockUserEnabled">屏蔽用户</label>\n    <span class="tips" data-toggle="tooltip" title="开启屏蔽用户的功能，你将看不见所屏蔽用户的发言，请点击详细设置管理屏蔽用户">[?]</span>\n    <a class="ml-3" data-name="openBlockUserDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n  \n  <div class="form-check">\n    <input class="form-check-input" id="configDialog_blockThreadEnabled" name="blockThreadEnabled" type="checkbox" data-disabled="[data-name=openBlockThreadDialog]">\n    <label class="form-check-label" for="configDialog_blockThreadEnabled">屏蔽主题</label>\n    <span class="tips" data-toggle="tooltip" title="开启屏蔽标题中包含指定关键字的主题的功能，请点击详细设置管理屏蔽关键字">[?]</span>\n    <a class="ml-3" data-name="openBlockThreadDialog" href="#" role="button">详细设置&raquo;</a>\n  </div>\n</fieldset>','\n<button class="btn btn-warning mr-auto" name="openImportOrExportSettingDialog" type="button">导入/导出</button>\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>\n<button class="btn btn-danger" name="reset" type="button">重置</button>');a.submit(function(e){e.preventDefault(),(0,_config.read)();var t=getMainConfigValue(a);t=(0,_config.normalize)(t),$.extend(Config,t),(0,_config.write)(),Dialog.close(n)}).on("click",'a[data-name^="open"][href="#"]',function(e){e.preventDefault();var t=$(this);if(!t.hasClass("disabled-link")){var n=t.data("name");"openRunCommandDialog"===n?showRunCommandDialog():"openUserMemoDialog"===n?showUserMemoDialog():"openCustomCssDialog"===n?showCustomCssDialog():"openCustomScriptDialog"===n?Script.showDialog():"openFollowUserDialog"===n?showFollowUserDialog():"openBlockUserDialog"===n?showBlockUserDialog():"openBlockThreadDialog"===n&&showBlockThreadDialog()}}).find('[data-name="clearTmpData"]').click(function(e){e.preventDefault();var t=prompt("可清除与助手有关的Cookies和本地临时数据（不包括助手设置和日志）\n请填写清除类型，0：全部清除；1：清除Cookies；2：清除本地临时数据",0);null!==t&&(t=parseInt(t),!isNaN(t)&&0<=t&&(clearTmpData(t),alert("缓存已清除")))}).end().find('[name="reset"]').click(function(){confirm("是否重置所有设置？")&&((0,_config.clear)(),alert("设置已重置"),Dialog.close(n),location.reload())}).end().find('[name="openImportOrExportSettingDialog"]').click(showImportOrExportSettingDialog),setMainConfigValue(a),Dialog.show(n)}},setMainConfigValue=function(e){e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?e.prop("checked",!0===Config[t]):e.val(Config[t]))}),e.find('[name="threadContentFontSize"]').val(0<Config.threadContentFontSize?Config.threadContentFontSize:"")},getMainConfigValue=function(e){var n={};return e.find("input[name], select[name]").each(function(){var e=$(this),t=e.attr("name");t in Config&&(e.is('[type="checkbox"]')&&"boolean"==typeof Config[t]?n[t]=Boolean(e.prop("checked")):"number"==typeof Config[t]?(n[t]=parseInt(e.val()),"threadContentFontSize"===t&&isNaN(n[t])&&(n[t]=0)):n[t]=$.trim(e.val()))}),n},clearTmpData=function(e){var t=0<arguments.length&&void 0!==e?e:0;if(0===t||1===t)for(var n in _const2.default)/CookieName$/.test(n)&&Util.deleteCookie(_const2.default[n]);0!==t&&2!==t||localStorage.removeItem(_const2.default.multiQuoteStorageName)},showRunCommandDialog=function(){var e="runCommandDialog";if(!(0<$("#"+e).length)){var t=Dialog.create(e,"运行命令",'\n<p class="font-size-sm">\n  运行命令快捷键：<kbd>Ctrl+Enter</kbd>；清除命令快捷键：<kbd>Ctrl+退格键</kbd>\n</p>\n<div class="form-group">\n  <label for="cfgCmd">命令内容：</label>\n  <textarea class="form-control" name="cmd" id="cfgCmd" rows="6" wrap="off" aria-label="命令内容" style="white-space: pre;"></textarea>\n</div>\n<div class="form-group">\n  <label for="cfgResult">运行结果：</label>\n  <textarea class="form-control font-size-sm" name="result" id="cfgResult" rows="6" wrap="off" aria-label="运行结果" style="white-space: pre;"></textarea>\n</div>','\n<button class="btn btn-primary" type="submit">运行</button>\n<button class="btn btn-danger" name="clear" type="button">清除</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">关闭</button>'),a=t.find('[name="cmd"]'),o=t.find('[name="result"]');t.submit(function(e){e.preventDefault();var t=a.val();if($.trim(t)){var n=Script.runCmd(t,!0).response;o.val(n)}}).end().find('[name="clear"]').click(function(){a.val("").focus()}),a.keydown(function(e){e.ctrlKey&&13===e.keyCode?t.submit():e.ctrlKey&&8===e.keyCode&&t.find('[name="clear"]').click()}),Dialog.show(e),a.focus()}},showImportOrExportSettingDialog=function(){var e="imOrExSettingDialog";if(!(0<$("#"+e).length)){(0,_config.read)();var n=Dialog.create(e,"导入或导出设置",'\n<p class="font-size-sm">\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可<br>\n  <span class="text-danger">注：本设置与电脑版的KFOL助手并不完全通用</span>\n</p>\n<div class="form-group">\n  <textarea class="form-control font-size-sm font-monospace" name="setting" rows="10" aria-label="设置内容" style="word-break: break-all;"></textarea>\n</div>','\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>');n.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(n.find('[name="setting"]').val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}t&&"object"===$.type(t)?(t=(0,_config.normalize)(t),window.Config=$.extend(!0,{},_config.Config,t),(0,_config.write)(),alert("设置已导入"),location.reload()):alert("设置有错误")}}}),Dialog.show(e),n.find('[name="setting"]').val(JSON.stringify(Util.getDifferenceSetOfObject(_config.Config,Config))).select().focus()}},showUserMemoDialog=function(){var p="userMemoDialog";if(!(0<$("#"+p).length)){(0,_config.read)();var e=Dialog.create(p,"用户备注",'\n<p class="font-size-sm">按照<code>用户名:备注</code>的格式（注意是英文冒号），每行一个</p>\n<div class="form-group">\n  <textarea class="form-control" name="userMemoList" rows="13" wrap="off" aria-label="用户备注" style="white-space: pre;"></textarea>\n</div>','\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>'),m=e.find('[name="userMemoList"]');e.submit(function(e){e.preventDefault();var t=$.trim(m.val()),n=!0,a=!(Config.userMemoList={}),o=void 0;try{for(var i,r=t.split("\n")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(l=$.trim(l)){if(!/.+?:.+/.test(l))return alert("格式不正确"),void m.focus();var s=l.split(":"),c=_slicedToArray(s,2),d=c[0],u=c[1],f=void 0===u?"":u;f&&(Config.userMemoList[d.trim()]=f.trim())}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}(0,_config.write)(),Dialog.close(p)});var t="",n=!0,a=!1,o=void 0;try{for(var i,r=Object.entries(Config.userMemoList)[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=_slicedToArray(i.value,2);t+=l[0]+":"+l[1]+"\n"}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Dialog.show(p),m.val(t).focus()}},showCustomCssDialog=function(){var t="customCssDialog";if(!(0<$("#"+t).length)){(0,_config.read)();var e=Dialog.create(t,"自定义CSS",'\n<div class="form-group">\n  <textarea class="form-control font-size-sm font-monospace" name="customCssContent" rows="15" wrap="off" aria-label="自定义CSS内容" style="white-space: pre;"></textarea>\n</div>','\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>'),n=e.find('[name="customCssContent"]');e.submit(function(e){e.preventDefault(),Config.customCssContent=$.trim(n.val()),(0,_config.write)(),Dialog.close(t),alert("自定义CSS修改成功（需刷新页面后才可生效）")}),Dialog.show(t),n.val(Config.customCssContent).focus()}},showFollowUserDialog=function(){var t="followUserDialog";if(!(0<$("#"+t).length)){var l=Dialog.create(t,"关注用户",'\n<div class="form-check">\n  <input class="form-check-input" id="followUserDialog_highlightFollowUserThreadInHpEnabled" name="highlightFollowUserThreadInHpEnabled" type="checkbox">\n  <label class="form-check-label" for="followUserDialog_highlightFollowUserThreadInHpEnabled">高亮所关注用户的首页主题链接</label>\n  <span class="tips" data-toggle="tooltip" title="高亮所关注用户在首页下的主题链接">[?]</span>\n</div>\n<div class="form-check mb-3">\n  <input class="form-check-input" id="followUserDialog_highlightFollowUserThreadLinkEnabled" name="highlightFollowUserThreadLinkEnabled" type="checkbox">\n  <label class="form-check-label" for="followUserDialog_highlightFollowUserThreadLinkEnabled">高亮所关注用户的主题链接</label>\n  <span class="tips" data-toggle="tooltip" title="高亮所关注用户在版块页面下的主题链接">[?]</span>\n</div>\n<ul class="list-unstyled" id="followUserList"></ul>\n<div class="btn-group btn-group-sm mb-3" role="group">\n  <button class="btn btn-secondary" name="selectAll" type="button">全选</button>\n  <button class="btn btn-secondary" name="selectInverse" type="button">反选</button>\n  <button class="btn btn-danger" name="deleteSelect" type="button">删除</button>\n</div>\n<div class="input-group mb-3">\n  <input class="form-control" name="addUser" data-toggle="tooltip" type="text" title="添加多个用户请用英文逗号分隔" aria-label="添加关注用户">\n  <div class="input-group-append">\n    <button class="btn btn-success" name="add" type="button">添加</button>\n  </div>\n</div>\n','\n<button class="btn btn-warning mr-auto" name="openImOrExFollowUserListDialog" type="button">导入/导出</button>\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>'),s=l.find("#followUserList"),c=function(e){$('\n<li class="input-group input-group-sm mb-2">\n  <div class="input-group-prepend">\n    <div class="input-group-text">\n      <input type="checkbox" aria-label="选择用户">\n    </div>\n  </div>\n  <input class="form-control" name="userName" type="text" value="'+e+'" maxlength="12" aria-label="编辑关注用户">\n  <div class="input-group-append">\n    <button class="btn btn-danger" name="delete" type="button" aria-label="删除关注用户">\n      <i class="fa fa-trash" aria-hidden="true"></i>\n    </button>\n  </div>\n</li>\n').appendTo(s)};l.submit(function(e){e.preventDefault(),Config.highlightFollowUserThreadInHPEnabled=l.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked"),Config.highlightFollowUserThreadLinkEnabled=l.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked"),Config.followUserList=[],s.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="userName"]').val());""!==t&&-1===Util.inFollowOrBlockUserList(t,Config.followUserList)&&Config.followUserList.push({name:t})}),(0,_config.write)(),Dialog.close(t)}).find('[name="deleteSelect"]').click(function(){var e=s.find('li:has([type="checkbox"]:checked)');e.length&&confirm("是否删除所选用户？")&&e.remove()}).end().find('[name="addUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next().find("button").click())}).end().find('[name="add"]').click(function(){var e=l.find('[name="addUser"]'),t=!0,n=!1,a=void 0;try{for(var o,i=$.trim(e.val()).split(",")[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;(r=$.trim(r))&&-1===Util.inFollowOrBlockUserList(r,Config.followUserList)&&c(r)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}e.val(""),s.find('li:last-child [type="checkbox"]').focus()}).end().find('[name="openImOrExFollowUserListDialog"]').click(function(){Public.showCommonImportOrExportConfigDialog("关注用户","followUserList")}).end().find('[name="selectAll"]').click(function(){return Util.selectAll(s.find('[type="checkbox"]'))}).end().find('[name="selectInverse"]').click(function(){return Util.selectInverse(s.find('[type="checkbox"]'))}),s.on("click",'[name="delete"]',function(){$(this).closest("li").remove()}),l.find('[name="highlightFollowUserThreadInHpEnabled"]').prop("checked",Config.highlightFollowUserThreadInHPEnabled),l.find('[name="highlightFollowUserThreadLinkEnabled"]').prop("checked",Config.highlightFollowUserThreadLinkEnabled);var e=!0,n=!1,a=void 0;try{for(var o,i=Config.followUserList[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var r=o.value;c(r.name)}}catch(e){n=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(n)throw a}}Dialog.show(t)}},showBlockUserDialog=function(){var s="blockUserDialog";if(!(0<$("#"+s).length)){var c=Dialog.create(s,"屏蔽用户",'\n<div class="form-group mb-2">\n  <label for="blockUserDefaultType">默认屏蔽类型</label>\n  <select class="custom-select custom-select-sm w-auto" id="blockUserDefaultType" name="blockUserDefaultType">\n    <option value="0">主题和回帖</option><option value="1">主题</option><option value="2">回帖</option>\n  </select>\n  <div class="form-check form-check-inline ml-3">\n    <input class="form-check-input" id="blockUserDialog_blockUserAtTipsEnabled" name="blockUserAtTipsEnabled" type="checkbox">\n    <label class="form-check-label" for="blockUserDialog_blockUserAtTipsEnabled">屏蔽@提醒</label>\n    <span class="tips" data-toggle="tooltip" title="屏蔽被屏蔽用户的@提醒">[?]</span>\n  </div>\n</div>\n<div class="form-group mb-2">\n  <label for="blockUserForumType">版块屏蔽范围</label>\n  <select class="custom-select custom-select-sm w-auto" id="blockUserForumType" name="blockUserForumType">\n    <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n  </select>\n</div>\n<div class="form-group">\n  <label>版块ID列表</label>\n  <span class="tips" data-toggle="tooltip" title="版块URL中的fid参数，多个ID请用英文逗号分隔">[?]</span>\n  <input class="form-control form-control-sm" name="blockUserFidList" type="text">\n</div>\n<ul class="list-unstyled" id="blockUserList"></ul>\n<div class="btn-group btn-group-sm mb-3" role="group">\n  <button class="btn btn-secondary" name="selectAll" type="button">全选</button>\n  <button class="btn btn-secondary" name="selectInverse" type="button">反选</button>\n  <div class="btn-group btn-group-sm dropup">\n    <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" type="button" aria-haspopup="true" aria-expanded="false">\n      修改为\n    </button>\n    <div class="dropdown-menu" data-name="modifyMenu">\n      <a class="dropdown-item" data-value="0" href="#">主题和回帖</a>\n      <a class="dropdown-item" data-value="1" href="#">主题</a>\n      <a class="dropdown-item" data-value="2" href="#">回帖</a>\n    </div>\n  </div>\n  <button class="btn btn-danger" name="deleteSelect" type="button">删除</button>\n</div>\n<div class="input-group mb-3">\n  <input class="form-control" name="addUser" data-toggle="tooltip" type="text" title="添加多个用户请用英文逗号分隔" aria-label="添加屏蔽用户">\n  <div class="input-group-append">\n    <button class="btn btn-success" name="add" type="button">添加</button>\n  </div>\n</div>','\n<button class="btn btn-warning mr-auto" name="openImOrExBlockUserListDialog" type="button">导入/导出</button>\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>'),d=c.find("#blockUserList"),u=function(e,t){$('\n<li class="form-group row no-gutters mb-2">\n  <div class="col-7 input-group input-group-sm">\n    <div class="input-group-prepend">\n      <div class="input-group-text">\n        <input type="checkbox" aria-label="选择用户">\n      </div>\n    </div>\n    <input class="form-control" name="userName" type="text" value="'+e+'" maxlength="12" aria-label="编辑屏蔽用户">\n  </div>\n  <div class="col-5 input-group input-group-sm">\n    <select class="form-control" name="blockType">\n      <option value="0">主题和回帖</option><option value="1">主题</option><option value="2">回帖</option>\n    </select>\n    <div class="input-group-append">\n      <button class="btn btn-danger" name="delete" type="button" aria-label="删除屏蔽用户">\n        <i class="fa fa-trash" aria-hidden="true"></i>\n      </button>\n    </div>\n  </div>\n</li>\n').appendTo(d).find('[name="blockType"]').val(t)};c.submit(function(e){e.preventDefault(),Config.blockUserDefaultType=parseInt(c.find('[name="blockUserDefaultType"]').val()),Config.blockUserAtTipsEnabled=c.find('[name="blockUserAtTipsEnabled"]').prop("checked"),Config.blockUserForumType=parseInt(c.find('[name="blockUserForumType"]').val());var t=new Set,n=!0,a=!1,o=void 0;try{for(var i,r=$.trim(c.find('[name="blockUserFidList"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=parseInt(l),!isNaN(l)&&0<l&&t.add(l)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Config.blockUserFidList=[].concat(_toConsumableArray(t)),Config.blockUserList=[],d.find("li").each(function(){var e=$(this),t=$.trim(e.find('[name="userName"]').val());if(t&&-1===Util.inFollowOrBlockUserList(t,Config.blockUserList)){var n=parseInt(e.find('[name="blockType"]').val());Config.blockUserList.push({name:t,type:n})}}),(0,_config.write)(),Dialog.close(s)}).find('[data-name="modifyMenu"]').on("click","a",function(e){e.preventDefault();var t=parseInt($(this).data("value"));d.find('li:has([type="checkbox"]:checked) select').val(t)}).end().find('[name="deleteSelect"]').click(function(){var e=d.find('li:has([type="checkbox"]:checked)');e.length&&confirm("是否删除所选用户？")&&e.remove()}).end().find('[name="addUser"]').keydown(function(e){13===e.keyCode&&(e.preventDefault(),$(this).next().find("button").click())}).end().find('[name="add"]').click(function(){var e=c.find('[name="addUser"]'),t=parseInt(c.find('[name="blockUserDefaultType"]').val()),n=!0,a=!1,o=void 0;try{for(var i,r=$.trim(e.val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;(l=$.trim(l))&&-1===Util.inFollowOrBlockUserList(l,Config.blockUserList)&&u(l,t)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}e.val(""),d.find('li:last-child [type="checkbox"]').focus()}).end().find('[name="blockUserForumType"]').change(function(){c.find('[name="blockUserFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[name="openImOrExBlockUserListDialog"]').click(function(){Public.showCommonImportOrExportConfigDialog("屏蔽用户","blockUserList")}).end().find('[name="selectAll"]').click(function(){return Util.selectAll(d.find('[type="checkbox"]'))}).end().find('[name="selectInverse"]').click(function(){return Util.selectInverse(d.find('[type="checkbox"]'))}),d.on("click",'[name="delete"]',function(){$(this).closest("li").remove()}),c.find('[name="blockUserDefaultType"]').val(Config.blockUserDefaultType),c.find('[name="blockUserAtTipsEnabled"]').prop("checked",Config.blockUserAtTipsEnabled),c.find('[name="blockUserForumType"]').val(Config.blockUserForumType).triggerHandler("change"),c.find('[name="blockUserFidList"]').val(Config.blockUserFidList.join(","));var e=!0,t=!1,n=void 0;try{for(var a,o=Config.blockUserList[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;u(i.name,i.type)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}Dialog.show(s)}},showBlockThreadDialog=function showBlockThreadDialog(){var dialogName="blockThreadDialog";if(!(0<$("#"+dialogName).length)){var bodyContent='\n<p class="font-size-sm">\n  标题关键字可使用普通字符串或正则表达式，正则表达式请使用<code>/abc/</code>的格式，例：<code>/关键字A.*关键字B/i</code><br>\n  用户名和版块ID为可选项（多个用户名或版块ID请用英文逗号分隔）<br>\n</p>\n<div class="form-group mb-2">\n  <label for="blockThreadDefForumType">默认版块屏蔽范围</label>\n  <select class="custom-select custom-select-sm w-auto" id="blockThreadDefForumType" name="blockThreadDefForumType">\n    <option value="0">所有版块</option><option value="1">包括指定版块</option><option value="2">排除指定版块</option>\n  </select>\n</div>\n<div class="form-group">\n  <label for="blockThreadDefFidList">默认版块ID列表</label>\n  <input class="form-control form-control-sm" id="blockThreadDefFidList" name="blockThreadDefFidList" type="text">\n</div>\n<div class="table-responsive">\n  <table class="table table-sm table-hover table-center text-nowrap">\n    <thead>\n      <tr>\n        <th>标题关键字(必填)</th>\n        <th>屏蔽用户</th>\n        <th>用户名</th>\n        <th>屏蔽范围</th>\n        <th>版块ID</th>\n        <th></th>\n      </tr>\n    </thead>\n    <tbody id="blockThreadList"></tbody>\n  </table>\n</div>\n<div class="btn-group btn-group-sm mb-3" role="group">\n  <button class="btn btn-success" name="add" type="button">增加</button>\n  <button class="btn btn-danger" name="clear" type="button">清空</button>\n</div>',footerContent='\n<button class="btn btn-warning mr-auto" name="openImOrExBlockThreadListDialog" type="button">导入/导出</button>\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>',$dialog=Dialog.create(dialogName,"屏蔽主题",bodyContent,footerContent),$blockThreadList=$dialog.find("#blockThreadList"),addBlockThread=function(e,t,n,a,o){$('\n<tr>\n  <td>\n    <input class="form-control form-control-sm" name="keyWord" type="text" value="'+e+'" aria-label="标题关键字" style="min-width: 12rem;">\n  </td>\n  <td>\n    <select class="form-control form-control-sm" name="userType" aria-label="屏蔽用户类型" style="min-width: 4.5rem;">\n      <option value="0">所有</option><option value="1">包括</option><option value="2">排除</option>\n    </select>\n  </td>\n  <td>\n    <input class="form-control form-control-sm" name="userList" type="text" value="'+n.join(",")+'" aria-label="用户名"\n           '+(0===t?"disabled":"")+' style="min-width: 12rem;">\n  </td>\n  <td>\n    <select class="form-control form-control-sm" name="fidType" aria-label="屏蔽范围" style="min-width: 4.5rem;">\n      <option value="0">所有</option><option value="1">包括</option><option value="2">排除</option>\n    </select>\n  </td>\n  <td>\n    <input class="form-control form-control-sm" name="fidList" type="text" value="'+o.join(",")+'" aria-label="版块ID列表"\n           '+(0===a?"disabled":"")+' style="min-width: 9rem;">\n  </td>\n  <td class="text-left">\n    <button class="btn btn-danger btn-sm" name="delete" type="button" aria-label="删除">\n      <i class="fa fa-trash" aria-hidden="true"></i>\n    </button>\n  </td>\n</tr>\n').appendTo($blockThreadList).find('[name="userType"]').val(t).end().find('[name="fidType"]').val(a)},verify=function verify(){var flag=!0;return $blockThreadList.find("tr").each(function(){var $this=$(this),$txtKeyWord=$this.find('[name="keyWord"]'),keyWord=$txtKeyWord.val();if($.trim(keyWord)&&/^\/.+\/[gimuy]*$/.test(keyWord))try{eval(keyWord)}catch(e){return alert("正则表达式不正确"),$txtKeyWord.select().focus(),flag=!1,!1}}),flag};$dialog.submit(function(e){if(e.preventDefault(),verify()){Config.blockThreadDefForumType=parseInt($dialog.find('[name="blockThreadDefForumType"]').val());var t=new Set,n=!0,a=!1,o=void 0;try{for(var i,r=$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(",")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;l=parseInt(l),!isNaN(l)&&0<l&&t.add(l)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}Config.blockThreadDefFidList=[].concat(_toConsumableArray(t)),Config.blockThreadList=[],$blockThreadList.find("tr").each(function(){var e=$(this),t=e.find('[name="keyWord"]').val();if($.trim(t)){var n={keyWord:t},a=parseInt(e.find('[name="userType"]').val());if(0<a){var o=new Set,i=!0,r=!1,l=void 0;try{for(var s,c=$.trim(e.find('[name="userList"]').val()).split(",")[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var d=s.value;(d=$.trim(d))&&o.add(d)}}catch(e){r=!0,l=e}finally{try{!i&&c.return&&c.return()}finally{if(r)throw l}}0<o.size&&(n[2===a?"excludeUser":"includeUser"]=[].concat(_toConsumableArray(o)))}var u=parseInt(e.find('[name="fidType"]').val());if(0<u){var f=new Set,p=!0,m=!1,g=void 0;try{for(var h,b=$.trim(e.find('[name="fidList"]').val()).split(",")[Symbol.iterator]();!(p=(h=b.next()).done);p=!0){var v=h.value;v=parseInt(v),!isNaN(v)&&0<v&&f.add(v)}}catch(e){m=!0,g=e}finally{try{!p&&b.return&&b.return()}finally{if(m)throw g}}0<f.size&&(n[2===u?"excludeFid":"includeFid"]=[].concat(_toConsumableArray(f)))}Config.blockThreadList.push(n)}}),(0,_config.write)(),Dialog.close(dialogName)}}).find('[name="clear"]').click(function(){confirm("是否清除所有屏蔽关键字？")&&$blockThreadList.html("")}).end().find('[name="add"]').click(function(){addBlockThread("",0,[],parseInt($dialog.find('[name="blockThreadDefForumType"]').val()),$.trim($dialog.find('[name="blockThreadDefFidList"]').val()).split(","))}).end().find('[name="blockThreadDefForumType"]').change(function(){$dialog.find('[name="blockThreadDefFidList"]').prop("disabled",0===parseInt($(this).val()))}).end().find('[name="openImOrExBlockThreadListDialog"]').click(function(){Public.showCommonImportOrExportConfigDialog("屏蔽主题","blockThreadList")}).end().find('[name="selectAll"]').click(function(){return Util.selectAll($blockThreadList.find('[type="checkbox"]'))}).end().find('[name="selectInverse"]').click(function(){return Util.selectInverse($blockThreadList.find('[type="checkbox"]'))}),$blockThreadList.on("change","select",function(){var e=$(this);e.closest("td").next("td").find("input").prop("disabled",0===parseInt(e.val()))}).on("click",'[name="delete"]',function(){$(this).closest("tr").remove()}),$dialog.find('[name="blockThreadDefForumType"]').val(Config.blockThreadDefForumType).triggerHandler("change"),$dialog.find('[name="blockThreadDefFidList"]').val(Config.blockThreadDefFidList.join(","));var _iteratorNormalCompletion11=!0,_didIteratorError11=!1,_iteratorError11=void 0;try{for(var _iterator11=Config.blockThreadList[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=!0){var data=_step11.value,keyWord=data.keyWord,includeUser=data.includeUser,excludeUser=data.excludeUser,includeFid=data.includeFid,excludeFid=data.excludeFid,userType=0,userList=[];void 0!==includeUser?(userType=1,userList=includeUser):void 0!==excludeUser&&(userType=2,userList=excludeUser);var fidType=0,fidList=[];void 0!==includeFid?(fidType=1,fidList=includeFid):void 0!==excludeFid&&(fidType=2,fidList=excludeFid),addBlockThread(keyWord,userType,userList,fidType,fidList)}}catch(e){_didIteratorError11=!0,_iteratorError11=e}finally{try{!_iteratorNormalCompletion11&&_iterator11.return&&_iterator11.return()}finally{if(_didIteratorError11)throw _iteratorError11}}Dialog.show(dialogName)}}},{"./config":2,"./const":4,"./dialog":5,"./public":10,"./script":12,"./util":13}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={atTipsTimeExpires:3,bgStyleExpires:365,storagePrefix:"kf_",multiQuoteStorageName:"kf_multiQuote",atTipsTimeCookieName:"atTipsTime",prevAtTipsTimeCookieName:"prevAtTipsTime",bgStyleCookieName:"bgStyle",commonForumList:[{fid:106,name:"新作动态"},{fid:41,name:"网盘下载"},{fid:16,name:"BT下载"},{fid:52,name:"游戏讨论"},{fid:84,name:"动漫讨论"},{fid:67,name:"CG下载"},{fid:5,name:"自由讨论"},{fid:56,name:"个人日记"},{fid:57,name:"同人漫本"}],availableForumList:[{fid:106,name:"新作动态"},{fid:52,name:"游戏讨论"},{fid:41,name:"网盘下载"},{fid:67,name:"CG下载"},{fid:16,name:"BT下载"},{fid:9,name:"无限资源"},{fid:102,name:"游戏推荐"},{fid:24,name:"疑难互助"},{fid:57,name:"同人漫本"},{fid:84,name:"动漫讨论"},{fid:92,name:"动画下载"},{fid:127,name:"漫画小说"},{fid:68,name:"ACG音乐"},{fid:163,name:"LIVE资源"},{fid:94,name:"原创绘画"},{fid:87,name:"实物交流"},{fid:86,name:"电子产品"},{fid:115,name:"文字作品"},{fid:96,name:"图片来源"},{fid:36,name:"寻求资源"},{fid:5,name:"自由讨论"},{fid:56,name:"个人日记"},{fid:4,name:"意见投诉"},{fid:93,name:"内部管理"},{fid:125,name:"水楼林立"},{fid:181,name:"私人日记"},{fid:98,name:"日本语版"},{fid:99,name:"意見箱"},{fid:112,name:"掲示板"},{fid:100,name:"創作感想"}]};n.default=a},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.close=n.resize=n.show=n.create=void 0;var r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./util"));n.create=function(t,e,n,a){var o=3<arguments.length&&void 0!==a?a:"",i=$('\n<form>\n<div class="dialog" id="'+t+'" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="'+t+'Title">\n  <div class="container dialog-content" role="document">\n    <div class="dialog-header">\n      <h5 class="dialog-title" id="'+t+'Title">'+e+'</h5>\n      <button class="close" data-dismiss="dialog" type="button" aria-label="关闭">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="dialog-body">'+n+'</div>\n    <div class="dialog-footer" '+(o?"":"hidden")+">"+o+"</div>\n  </div>\n</div>\n</form>").appendTo("body");return i.on("click",'[data-dismiss="dialog"]',function(){return s(t)}).on("click",".tips",function(){return!1}).on("click",".disabled-link",function(){return!1}).on("click",".dialog",function(e){$(e.target).hasClass("dialog")&&s(t)}).keydown(function(e){if(27===e.keyCode)return s(t)}).find('legend [type="checkbox"]').click(function(){var e=$(this),t=e.prop("checked");r.isOpera()||r.isEdge()?e.closest("fieldset").find("input, select, textarea, button").not("legend input").prop("disabled",!t):e.closest("fieldset").prop("disabled",!t)}).end().find("input[data-disabled]").click(function(){var e=$(this),t=e.prop("checked");$(e.data("disabled")).each(function(){var e=$(this);e.is("a")?t?e.removeClass("disabled-link"):e.addClass("disabled-link"):e.prop("disabled",!t)})}).end().find('[data-toggle="tooltip"]').tooltip({container:"body"}),$(window).on("resize."+t,function(){return l(t)}),i},n.show=function(e){var t=$("#"+e);t.length&&(t.find('legend [type="checkbox"]').each(function(){$(this).triggerHandler("click")}).end().find("input[data-disabled]").each(function(){$(this).triggerHandler("click")}),t.fadeIn("normal").find(".close:first").focus(),l(e),$("body").addClass("modal-open"))};var l=n.resize=function(e){var t=$("#"+e);t.find(".dialog-body").css("max-height",$(window).height()-t.find(".dialog-header").outerHeight()-t.find(".dialog-footer").outerHeight())},s=n.close=function(e){return $("#"+e).fadeOut("normal",function(){$(this).parent().remove(),$(".dialog").length||$("body").removeClass("modal-open")}),$(window).off("resize."+e),!1}},{"./util":13}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleSelectBg=n.handleIndexThreadPanel=n.handleAtTipsBtn=void 0;var a,o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./util")),i=e("./const"),r=(a=i)&&a.__esModule?a:{default:a},l=e("./config");n.handleAtTipsBtn=function(){$("#atTips").click(function(){var e=$(this),t=e.data("time"),n=o.getCookie(r.default.atTipsTimeCookieName);if(t&&t!==n){if(n)n!==t&&o.setCookie(r.default.prevAtTipsTimeCookieName,n);else{var a=(new Date).getDate().toString();o.setCookie(r.default.prevAtTipsTimeCookieName,a.padStart(2,"0")+"日00时00分")}o.setCookie(r.default.atTipsTimeCookieName,t,o.getDate("+"+r.default.atTipsTimeExpires+"d")),e.removeClass("btn-outline-danger").addClass("btn-outline-primary")}})},n.handleIndexThreadPanel=function(){Config.activeNewExtraPanel&&$('a[data-toggle="tab"][href="'+Config.activeNewExtraPanel+'"]').tab("show"),$(document).on("shown.bs.tab",'[data-toggle="tab"]',function(e){var t=$(e.target).attr("href");if(t.includes("newExtraPanel")){var n="activeNewExtraPanel";Config[n]!==t&&((0,l.read)(),Config[n]=t,(0,l.write)())}})},n.handleSelectBg=function(){$("#selectBgImage").on("click","[data-id]",function(){var e=$(this),t=e.data("id"),n=e.data("filename"),a=e.parent().data("path");t&&n&&a&&confirm("是否选择此背景图片？")&&(o.setCookie(r.default.bgStyleCookieName,t,o.getDate("+"+r.default.bgStyleExpires+"d"),r.default.storagePrefix),$("body, .modal-content").css("background-image",'url("'+a+n+'")'),alert("背景已更换（图片可能需要一定时间加载）"))}).on("click","[data-color]",function(){var e=$(this).data("color");e&&confirm("是否选择此背景颜色？")&&(o.setCookie(r.default.bgStyleCookieName,e,o.getDate("+"+r.default.bgStyleExpires+"d"),r.default.storagePrefix),$("body, .modal-content").css("background",e),alert("背景已更换"))}),$("#customBgStyle").click(function(){var e=o.getCookie(r.default.bgStyleCookieName,r.default.storagePrefix);if(e&&!parseInt(e)||(e=""),null!==(e=prompt("请输入背景图片URL、颜色代码或CSS样式：\n（例：http://xxx.com/abc.jpg 或 #fcfcfc，留空表示恢复默认背景）\n（注：建议选择简洁、不花哨、偏浅色系的背景图片或颜色）",e))){var t=$("body, .modal-content, .dialog-content");""===$.trim(e)?(o.deleteCookie(r.default.bgStyleCookieName,r.default.storagePrefix),alert("背景已恢复默认"),location.reload()):/^https?:\/\/[^"']+/.test(e)?(o.setCookie(r.default.bgStyleCookieName,e,o.getDate("+"+r.default.bgStyleExpires+"d"),r.default.storagePrefix),t.css("background-image",'url("'+e+'")'),alert("背景已更换（图片可能需要一定时间加载）")):/^#[0-9a-f]{6}$/i.test(e)?(o.setCookie(r.default.bgStyleCookieName,e,o.getDate("+"+r.default.bgStyleExpires+"d"),r.default.storagePrefix),t.css("background",e.toLowerCase()),alert("背景已更换")):/[<>{}]/.test(e)?alert("格式不正确"):(e=e.replace(";",""),o.setCookie(r.default.bgStyleCookieName,e,o.getDate("+"+r.default.bgStyleExpires+"d"),r.default.storagePrefix),t.css("background",e),alert("背景已更换（图片可能需要一定时间加载）"))}})}},{"./config":2,"./const":4,"./util":13}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=n.show=function(e,t){var n={msg:"",duration:Config.defShowMsgDuration,clickable:!0,preventable:!1};"object"===$.type(e)?$.extend(n,e):(n.msg=e,n.duration=void 0===t?Config.defShowMsgDuration:t);var a=$(".msg-container"),o=0===a.length;o||$(".mask").length||a.height()>=.8*$(window).height()&&(l(),o=!0),n.preventable&&!$(".mask").length&&$('<div class="mask"></div>').appendTo("body"),o&&(a=$('<div class="container msg-container"></div>').appendTo("body"));var i=$('<div class="msg">'+n.msg+"</div>").appendTo(a);return i.on("click",".stop-action",function(e){e.preventDefault(),$(this).text("正在停止&hellip;").closest(".msg").data("stop",!0)}),n.clickable&&i.css("cursor","pointer").click(function(){r($(this))}).find("a").click(function(e){e.stopPropagation()}),n.preventable&&i.attr("preventable",!0),i.slideDown("normal"),-1<n.duration&&setTimeout(function(){r(i)},1e3*n.duration),i},r=(n.wait=function(e,t){return a({msg:e+='<i class="fa fa-spinner fa-spin fa-lg fa-fw ml-3" aria-label="等待中" aria-hidden="true"></i>',duration:-1,clickable:!1,preventable:!(1<arguments.length&&void 0!==t)||t})},n.hide=function(e){e.slideUp("normal",function(){o($(this))})}),o=n.remove=function(e){var t=e.parent();e.remove(),$(".msg").length?$(".msg[preventable]").length||$(".mask").remove():(t.remove(),$(".mask").remove())},l=n.destroy=function(){$(".msg-container").remove(),$(".mask").remove()}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleBuyItemBtns=n.showMyInfoInItemShop=n.showSelfRateErrorSizeSubmitWarning=n.handleProfilePage=n.handleUserPageBtns=n.handleRegisterPage=n.bindMessageActionBtnsClick=n.handleUploadAvatarFileBtn=n.syncPerPageFloorNum=n.assignBirthdayField=n.bindFriendPageBtnsClick=n.bindFavorPageBtnsClick=n.tuiGame=n.handleGameIntroSearchArea=n.highlightUnReadAtTipsMsg=void 0;var a,l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./util")),o=e("./const"),i=(a=o)&&a.__esModule?a:{default:a},s=e("./config");n.highlightUnReadAtTipsMsg=function(){if(Info.gjc===Info.userName){var a=r.getCookie(i.default.prevAtTipsTimeCookieName);if(a&&/^\d+日\d+时\d+分$/.test(a)){var o="";$(".thread-list-item time").each(function(e){var t=$(this),n=$.trim(t.text());if(0===e&&(o=n),!(a<n&&n<=o))return!1;t.addClass("text-danger"),o=n}),$(document).on("click",".thread-list-item .thread-link-item a",function(){r.deleteCookie(i.default.prevAtTipsTimeCookieName)})}}},n.handleGameIntroSearchArea=function(){$("#gameSearchKeyword").val(Info.keyword),$("#gameSearchType").val(Info.searchType)},n.tuiGame=function(){$(".tui-btn").click(function(e){e.preventDefault();var n=$(this);if(!n.data("wait")){var t=n.data("type"),a="";a="company"===t?"g_intro_inc_tui_":"type"===t?"g_intro_adv_tui_":"property"===t?"g_intro_moe_tui_":"g_intro_tui_",a+=Info.id,r.getCookie(a,"")?alert("你在48小时内已经推过"):(n.data("wait",!0),$.ajax({type:"GET",url:n.data("url"),success:function(){var e=n.find("span:first"),t=parseInt(e.text());e.text("+1"),setTimeout(function(){e.text(++t)},1e3)},error:function(){alert("操作失败")},complete:function(){n.removeData("wait")}}))}})},n.bindFavorPageBtnsClick=function(){var a=$('form[name="favorForm"]');$(document).on("click",".remove-catalog",function(){return confirm("是否删除该目录？")}),$("#addCatalog").click(function(e){e.preventDefault();var t=$.trim(prompt("请输入收藏夹目录名称："));t&&(a.find('[name="job"]').val("addtype"),a.find('[name="type"]').val(t),a.submit())}),$("#favorActionBtns").on("click","button",function(){var e=$(this).data("action");if("selectAll"===e)r.selectAll($('[name="delid[]"]'));else if("selectInverse"===e)r.selectInverse($('[name="delid[]"]'));else if("delete"===e){var t=$('[name="delid[]"]:checked');0<t.length&&confirm("是否删除这"+t.length+"项？")&&(a.find('[name="job"]').val("clear"),a.submit())}}),$("#convertCatalogDropdownMenu").on("click","a",function(e){e.preventDefault();var t=$(this).data("type"),n=$('[name="delid[]"]:checked');0<n.length&&confirm("是否将这"+n.length+"项转换到指定目录？")&&(a.find('[name="job"]').val("change"),a.find('[name="type"]').val(t),a.submit())})},n.bindFriendPageBtnsClick=function(){$("#friendActionBtns").on("click",'[type="button"]',function(){var e=$(this).data("action");"selectAll"===e?r.selectAll($('[name="selid[]"]')):"selectInverse"===e&&r.selectInverse($('[name="selid[]"]'))})},n.assignBirthdayField=function(){$("#birthday").change(function(){var e=$(this).val().trim(),t=/(\d{4})-(\d{1,2})-(\d{1,2})/.exec(e),n="",a="",o="";t&&(n=parseInt(t[1]),a=parseInt(t[2]),o=parseInt(t[3])),$('[name="proyear"]').val(n),$('[name="promonth"]').val(a),$('[name="proday"]').val(o)})},n.syncPerPageFloorNum=function(){function e(){var e=parseInt($('[name="p_num"]').val());0===e&&(e=10),isNaN(e)||e===Config.perPageFloorNum||(Config.perPageFloorNum=e,(0,s.write)())}e(),$("#creator").submit(function(){(0,s.read)(),e()})},n.handleUploadAvatarFileBtn=function(){$("#browseAvatar").change(function(){var e=$(this),t=/\.(\w+)$/.exec(e.val());t&&["jpg","gif","png"].includes(t[1].toLowerCase())||alert("头像图片类型不匹配")})},n.bindMessageActionBtnsClick=function(){$("#messageActionBtns").on("click","button",function(){var e=$("#messageListForm"),t=$(this).attr("name");if("selectAll"===t)r.selectAll($('[name="delid[]"]'));else if("selectInverse"===t)r.selectInverse($('[name="delid[]"]'));else if("selectCustom"===t){var l=$.trim(prompt("请填写所要选择的包含指定字符串的短消息标题（可用|符号分隔多个标题）","收到了他人转账的贡献|收到了他人转账的KFB|银行汇款通知|您的文章被评分|您的文章被删除"));if(!l)return;$('[name="delid[]"]').prop("checked",!1),$("a.thread-link").each(function(){var e=$(this),t=!0,n=!1,a=void 0;try{for(var o,i=l.split("|")[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var r=o.value;e.text().toLowerCase().includes(r.toLowerCase())&&e.parent().find('[name="delid[]"]').prop("checked",!0)}}catch(e){n=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw a}}})}else if("download"===t){var n=$('[name="delid[]"]:checked');0<n.length&&confirm("是否下载这"+n.length+"项？")&&(e.attr("action","/message.php").find('[name="action"]').val("down"),e.submit())}else if("delete"===t){var a=$('[name="delid[]"]:checked');0<a.length&&confirm("是否删除这"+a.length+"项？")&&(e.attr("action",r.makeUrl("message/job")).find('[name="action"]').val("del"),e.submit())}})},n.handleRegisterPage=function(){$(document).on("change","input[name]",function(){var e=$(this),t=e.attr("name"),n=e.val();n?(r.showValidationMsg($("#response"),"clear"),"regpwd"===t?16<n.length||n.length<6?r.showValidationMsg(e,"error","密码长度不正确"):(r.showValidationMsg(e,"clear"),$('[name="regpwdrepeat"]').trigger("change")):"regpwdrepeat"===t&&(n!==$('[name="regpwd"]').val()?r.showValidationMsg(e,"error","两次输入的密码不相符"):r.showValidationMsg(e,"clear"))):r.showValidationMsg(e,"clear")}),$("#registerBtn").click(function(){var a=$(this),e=a.closest("form");if(0<e.find(".has-danger").length)return alert("请正确填写表单"),!1;if("check"===a.data("action")){if("function"!=typeof window.namecheck)return;if(!window.namecheck())return;var o=$("#response");a.prop("disabled",!0),r.showValidationMsg(o,"wait","检查中，请稍等&hellip;"),$.post(r.makeUrl("register/check"),$('[name="checkForm"]').serialize(),function(e){var t=e.type,n=e.msg;a.prop("disabled",!1),r.showValidationMsg(o,t,n),"success"===t&&a.data("action","register").find("span:last-child").text("注册")}).fail(function(){r.showValidationMsg(o,"error","响应失败")})}else e.submit()})},n.handleUserPageBtns=function(){var e=$("#profileBtns"),i=e.data("username");e.on("click",'[name="followUser"], [name="blockUser"]',function(){(0,s.read)();var e=$(this),t="关注",n=Config.followUserList;if("blockUser"===e.attr("name")?(t="屏蔽",n=Config.blockUserList,Config.blockUserEnabled=!0):Config.followUserEnabled=!0,e.text().includes("取消")){var a=r.inFollowOrBlockUserList(i,n);-1<a&&(n.splice(a,1),(0,s.write)()),e.removeClass("btn-outline-danger").addClass("btn-outline-primary").find("span").text(t+"用户"),alert("该用户已被取消"+t)}else{if(-1===r.inFollowOrBlockUserList(i,n)){if("屏蔽"===t){var o=Config.blockUserDefaultType;if(null===(o=prompt("请填写屏蔽类型，0：主题和回帖；1：主题；2：回帖",o)))return;o=parseInt(o),(isNaN(o)||o<0||2<o)&&(o=Config.blockUserDefaultType),n.push({name:i,type:o})}else n.push({name:i});(0,s.write)()}e.removeClass("btn-outline-primary").addClass("btn-outline-danger").find("span").text("取消"+t),alert("该用户已被"+t)}}).find('[name="followUser"], [name="blockUser"]').each(function(){var e=$(this),t="关注",n=Config.followUserList;"blockUser"===e.attr("name")&&(t="屏蔽",n=Config.blockUserList),-1<r.inFollowOrBlockUserList(i,n)&&e.removeClass("btn-outline-primary").addClass("btn-outline-danger").find("span").text("取消"+t)})},n.handleProfilePage=function(){var e=$("#registerDate"),t=/(\d{4})-(\d{2})-(\d{2})/.exec(e.text());if(t){var n=new Date,a=l(t,4),o=a[1],i=a[2],r=a[3];parseInt(i)===n.getMonth()+1&&parseInt(r)===n.getDate()&&parseInt(o)<=n.getFullYear()&&e.attr("title","今天是该用户注册"+(n.getFullYear()-parseInt(o))+"周年纪念日").addClass("text-danger help")}},n.showSelfRateErrorSizeSubmitWarning=function(){$('form[name="selfRate"]').submit(function(){var e=$(this),t=parseFloat(e.find('[name="psize"]').val());if(!(isNaN(t)||t<=0)){2===parseInt(e.find('[name="psizegb"]').val())&&(t*=1024);var n=parseInt(e.find("a[data-title-size]").data("title-size"));return n&&(103*t/100+1<n||n<97*t/100-1)?confirm("标题文件大小("+n.toLocaleString()+"M)与认定文件大小("+t.toLocaleString()+"M)不一致，是否继续？"):void 0}})},n.showMyInfoInItemShop=function(){$.get("/profile.php?action=show&uid="+Info.uid+"&t="+$.now(),function(e){var t=/论坛货币：(\d+)\s*KFB/.exec(e),n=/贡献数值：(\d+(?:\.\d+)?)/.exec(e);if(t||n){var a=parseInt(t[1]),o=parseFloat(n[1]);$("#myInfo").html("当前持有 <b>"+a.toLocaleString()+"</b> KFB 和 <b>"+o+"</b> 贡献")}})},n.handleBuyItemBtns=function(){$("#itemList").on("click",'button[name="buy"]',function(){var e=$(this),t=e.data("id");confirm("是否购买此物品？")&&(e.prop("disabled",!0),$.post("/kf_fw_ig_shop.php","buy="+t+"&safeid="+Info.safeId).done(function(e){var t=r.removeHtmlTag(e);alert(t)}).fail(function(){return alert("连接超时")}).always(function(){return e.prop("disabled",!1)}))})}},{"./config":2,"./const":4,"./util":13}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.specialPostTitleChange=n.addRedundantKeywordWarning=n.handleClearMultiQuoteDataBtn=n.handleMultiQuote=n.addSmileCode=n.handleAttachBtns=n.checkPostForm=n.handleEditorBtns=void 0;var a,_=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},I=i(e("./util")),o=e("./const"),F=(a=o)&&a.__esModule?a:{default:a},L=i(e("./msg"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.handleEditorBtns=function(){var r=$("#postContent").get(0);$(document).on("click",".editor-btn-group button[data-action]",function(){var e=$(this).data("action"),t="";switch(e){case"link":t=prompt("请输入链接URL：","http://");break;case"img":t=prompt("请输入图片URL：","http://");break;case"sell":t=prompt("请输入出售金额：",1);break;case"hide":t=prompt("请输入神秘等级：",1);break;case"audio":t=prompt("请输入HTML5音频实际地址：\n（可直接输入网易云音乐的单曲地址，将自动转换为外链地址）","http://");var n=/^https?:\/\/music\.163\.com\/(?:#\/)?song\?id=(\d+)/i.exec(t);n&&(t="https://music.miaola.work/163/"+n[1]+".mp3"),(n=/^https?:\/\/www\.xiami\.com\/song\/(\w+)/i.exec(t))&&(t="https://music.miaola.work/xiami/"+n[1]+".mp3");break;case"video":t=prompt("请输入HTML5视频实际地址：\n（可直接输入YouTube视频页面的地址，将自动转换为外链地址）","http://");var a=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)/i.exec(t);a&&(t="https://video.miaola.work/youtube/"+a[1]),(a=/^https?:\/\/youtu\.be\/([\w\-]+)$/i.exec(t))&&(t="https://video.miaola.work/youtube/"+a[1])}if(null!==t){var o="",i="";switch(e){case"link":i="[url="+t+"]"+(o=I.getSelText(r))+"[/url]";break;case"img":i="[img]"+t+"[/img]";break;case"quote":i="[quote]"+(o=I.getSelText(r))+"[/quote]";break;case"code":i="[code]"+(o=I.getSelText(r))+"[/code]";break;case"sell":i="[sell="+t+"]"+(o=I.getSelText(r))+"[/sell]";break;case"hide":i="[hide="+t+"]"+(o=I.getSelText(r))+"[/hide]";break;case"bold":i="[b]"+(o=I.getSelText(r))+"[/b]";break;case"italic":i="[i]"+(o=I.getSelText(r))+"[/i]";break;case"underline":i="[u]"+(o=I.getSelText(r))+"[/u]";break;case"strike":i="[strike]"+(o=I.getSelText(r))+"[/strike]";break;case"super":i="[sup]"+(o=I.getSelText(r))+"[/sup]";break;case"sub":i="[sub]"+(o=I.getSelText(r))+"[/sub]";break;case"horizontal":i="[hr]";break;case"align-left":i="[align=left]"+(o=I.getSelText(r))+"[/align]";break;case"align-center":i="[align=center]"+(o=I.getSelText(r))+"[/align]";break;case"align-right":i="[align=right]"+(o=I.getSelText(r))+"[/align]";break;case"fly":i="[fly]"+(o=I.getSelText(r))+"[/fly]";break;case"audio":i="[audio]"+t+"[/audio]";break;case"video":i="[video]"+t+"[/video]"}i&&(I.addCode(r,i,o),r.focus())}}),$("#fontSizeDropdownMenu").on("click","a",function(e){e.preventDefault();var t=$(this).data("size"),n=I.getSelText(r),a="[size="+t+"]"+n+"[/size]";I.addCode(r,a,n),r.focus()}),$("#colorDropdownMenu, #bgColorDropdownMenu").on("click","span",function(){var e=$(this),t=e.parent().is("#bgColorDropdownMenu")?"backcolor":"color",n=e.data("color"),a=I.getSelText(r),o="["+t+"="+n+"]"+a+"[/"+t+"]";I.addCode(r,o,a),r.focus()})},n.checkPostForm=function(){$("#postForm").submit(function(){var e=$("#postType");if(0<e.length&&!e.val())return alert("没有选择主题分类"),e.focus(),!1;var t=$('[name="atc_title"]');if(0<t.length){var n=I.getStrByteLen(t.val());if(!n)return alert("标题不能为空"),t.focus(),!1;if(100<n)return alert("标题长度为 "+n+" 字节(不可超过 100 字节)，请减少标题长度"),t.focus(),!1}var a=$("#voteItemContent");if(0<a.length&&!a.val().trim())return alert("投票选项不能为空"),a.focus(),!1;var o=$("#postContent");if(0<o.length){var i=I.getStrByteLen(o.val().trim());if(i<12)return alert("文章内容少于 12 个字节"),o.focus(),!1;if(5e4<i)return alert("文章内容大于 50000 个字节"),o.focus(),!1}var r=$("#postGjc");return 0<r.length&&"new"===Info.action&&!r.val().trim()?(alert("请在内容文本框的下方填写关键词，以方便搜索，也可以在标题中选择任意一个词填入"),r.focus(),!1):void 0})},n.handleAttachBtns=function(){$(document).on("click",".attach-area a[data-action]",function(e){e.preventDefault();var t=$(this),n=t.closest(".attach-area"),a=t.data("action"),o=n.data("id");if(o)if("insert"===a){var i=t.data("type"),r=$("#postContent").get(0),l="["+("new"===i?"upload":"attachment")+"="+o+"]";I.addCode(r,l),r.focus()}else"update"===a?(n.find(".attach-info").prop("hidden",!0).after('<label><input name="replace_'+o+'" type="file" aria-label="选择附件"></label>'),t.data("action","cancel").text("取消").blur(),$(document).data("attachUpdateAlert")||(alert("本反向代理服务器为了提高性能对图片设置了缓存，更新附件图片后可能需等待最多30分钟才能看到效果"),$(document).data("attachUpdateAlert",!0))):"cancel"===a?(n.find(".attach-info").prop("hidden",!1).next("label").remove(),t.data("action","update").text("更新").blur()):"delete"===a&&n.remove()}),$(document).on("change",'[type="file"]',function(){var e=$(this),t=/\.(\w+)$/.exec(e.val());if(t&&["jpg","gif","png","torrent"].includes(t[1].toLowerCase())){if("new"===e.data("type")){e.removeData("type").parent().next().prop("hidden",!1);var n=$("#newAttachArea");if(5<=n.find('[type="file"]').length)return;var a=n.find('[type="file"]:last').closest(".attach-area"),o=parseInt(a.data("id"));if(!o)return;o++,$('\n<div class="form-group row font-size-sm attach-area" data-id="'+o+'">\n  <div class="col-12 col-form-label">\n    <label>\n      <input name="attachment_'+o+'" data-type="new" type="file" aria-label="选择附件">\n    </label>\n    <span hidden>\n      <a data-action="insert" data-type="new" href="#">插入</a>&nbsp;\n      <a data-action="delete" href="#">删除</a>\n    </span>\n  </div>\n  <div class="col-4">\n    <label class="sr-only" for="atc_downrvrc'+o+'">神秘系数</label>\n    <input class="form-control form-control-sm" id="atc_downrvrc'+o+'" name="atc_downrvrc'+o+'" data-toggle="tooltip" \ntype="number" value="0" min="0" title="神秘系数" placeholder="神秘系数">\n  </div>\n  <div class="col-8">\n    <label class="sr-only" for="atc_desc'+o+'">描述</label>\n    <input class="form-control form-control-sm" id="atc_desc'+o+'" name="atc_desc'+o+'" data-toggle="tooltip" type="text" \ntitle="描述" placeholder="描述">\n  </div>\n</div>\n').insertAfter(a).find('[data-toggle="tooltip"]').tooltip({container:"body"})}}else alert("附件类型不匹配")})},n.addSmileCode=function(n){$(".smile-panel").on("click","img",function(){$(".smile-panel").addClass("open");var e=n.get(0);if(e){var t="[s:"+$(this).data("id")+"]";I.addCode(e,t,""),e.blur()}}).parent().on("shown.bs.dropdown",function(){$(".smile-panel img").each(function(){var e=$(this);e.attr("src")||e.attr("src",e.data("src"))})}).on("hide.bs.dropdown",function(e){var t=$(e.relatedTarget);if(t.data("open"))return e.preventDefault();t.removeData("open")}),$("#smileDropdownBtn").click(function(){var e=$(this);e.data("open",!e.data("open"))})},n.handleMultiQuote=function(e){var t=0<arguments.length&&void 0!==e?e:1,n=localStorage[F.default.multiQuoteStorageName];if(n){try{n=JSON.parse(n)}catch(e){return}if(n&&"object"===$.type(n)&&!$.isEmptyObject(n)){var a=n,o=a.tid,i=a.quoteList;if(Info.tid&&o===Info.tid&&"object"===$.type(i)&&(2!==t||Info.fid)){var r=[],l=!0,s=!1,c=void 0;try{for(var d,u=Object.values(i)[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var f=d.value;if(Array.isArray(f)){var p=!0,m=!1,g=void 0;try{for(var h,b=f[Symbol.iterator]();!(p=(h=b.next()).done);p=!0){var v=h.value;r.push(v)}}catch(e){m=!0,g=e}finally{try{!p&&b.return&&b.return()}finally{if(m)throw g}}}}}catch(e){s=!0,c=e}finally{try{!l&&u.return&&u.return()}finally{if(s)throw c}}if(r.length){var y=new Set,k="",w=$('[name="diy_guanjianci"]');2===t&&(L.wait('<span class="mr-3">正在获取引用内容中&hellip;</span>剩余：<em class="text-warning countdown-num">'+r.length+"</em>"),$(document).clearQueue("MultiQuote")),$.each(r,function(a,e){void 0!==e.floor&&void 0!==e.pid&&(y.add(e.userName),2===t?$(document).queue("MultiQuote",function(){$.get(I.makeUrl("post/index","action=quote&fid="+Info.fid+"&tid="+o+"&pid="+e.pid+"&article="+e.floor+"&t="+(new Date).getTime()),function(e){var t=e.postContent;k+=t?t+(a===r.length-1?"":"\n"):"";var n=$(".countdown-num:last");n.text(parseInt(n.text())-1),a===r.length-1?(L.destroy(),$("#postContent").val(k).focus(),w.trigger("change")):setTimeout(function(){return $(document).dequeue("MultiQuote")},100)})}):k+="[quote]回 "+e.floor+"楼("+e.userName+") 的帖子[/quote]\n")});var C=!0,x=!1,S=void 0;try{for(var D,T=r.entries()[Symbol.iterator]();!(C=(D=T.next()).done);C=!0){var U=_(D.value,2);U[0],U[1]}}catch(e){x=!0,S=e}finally{try{!C&&T.return&&T.return()}finally{if(x)throw S}}w.val([].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(y)).join(",")),$("#postForm").submit(function(){localStorage.removeItem(F.default.multiQuoteStorageName)}),2===t?$(document).dequeue("MultiQuote"):($("#postContent").val(k).focus(),w.trigger("change"))}else localStorage.removeItem(F.default.multiQuoteStorageName)}}}},n.handleClearMultiQuoteDataBtn=function(){$(".clear-multi-quote-data-btn").click(function(e){e.preventDefault(),confirm("是否清除多重引用数据？")&&(localStorage.removeItem(F.default.multiQuoteStorageName),$('[name="diy_guanjianci"]').val(""),$("#postContent").val(""))})},n.addRedundantKeywordWarning=function(){$('input[name="diy_guanjianci"]').change(function(){var e=$(this);5<$.trim(e.val()).split(",").filter(function(e){return e}).length&&(alert("所填关键词已超过5个，多余的关键词将被忽略"),e.select().focus())})},n.specialPostTitleChange=function(){var e=$.trim($("#wangPanType").val()),t=$.trim($("#fileSize").val()),n=$.trim($("#expiryDate").val()),a=$.trim($("#fileFormat").val()),o=$("#ziGou").prop("checked")?"[自购]":"",i=$("#xinZuo").prop("checked")?"[新作]":"",r=$.trim($("#fileTitle").val()),l=new Date,s=(l.getMonth()+1).toString().padStart(2,"0"),c=l.getDate().toString().padStart(2,"0"),d="["+s+"."+c+"]"+o+i+r+"["+e+n+"]["+t+"]"+(a?"["+a+"]":""),u="["+s+"."+c+"]"+o+r+"["+e+n+"]["+t+"]"+(a?"["+a+"]":""),f=I.getStrByteLen(u);100<f?$("#previewTitle").text("标题总长度为"+f+"字节(不可超过100字节)，请减少标题长度").addClass("text-danger"):$("#previewTitle").text(d).removeClass("text-danger"),$("#realTitle").val(u)}},{"./const":4,"./msg":7,"./util":13}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.blockThread=exports.blockUsers=exports.followUsers=exports.showCommonImportOrExportConfigDialog=exports.preventCloseWindow=exports.fillCommonForumPanel=exports.showEditCommonForumDialog=exports.bindFastSubmitShortcutKey=exports.handlePageInput=exports.handleSearchDialog=exports.handleSidebarRollBtn=exports.showSidebarBtnGroup=exports.handleMainMenuLink=exports.handleMainMenu=void 0;var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_util=require("./util"),Util=_interopRequireWildcard(_util),_const=require("./const"),_const2=_interopRequireDefault(_const),_dialog=require("./dialog"),Dialog=_interopRequireWildcard(_dialog),_config=require("./config"),_configDialog=require("./configDialog"),ConfigDialog=_interopRequireWildcard(_configDialog);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var handleMainMenu=exports.handleMainMenu=function(){$("#mainMenuTogglerBtn").click(function(){var e=document.documentElement.clientHeight-$(this).closest(".navbar").outerHeight();0<e&&$("#mainMenu").css("max-height",e+"px")}),$("#sidebarMainMenuBtn").click(function(){return $("#mainMenuTogglerBtn").click()})},handleMainMenuLink=exports.handleMainMenuLink=function(){$("#mainMenu").find('[data-name="openConfigDialog"]').click(function(e){e.preventDefault(),$("#mainMenuTogglerBtn").click(),ConfigDialog.show()})},showSidebarBtnGroup=exports.showSidebarBtnGroup=function(){$(".sidebar-btn-group").prop("hidden",!1),Config.showSidebarRollBtnEnabled&&$("#sidebarRollBtn").prop("hidden",!1),Config.showSidebarMainMenuBtnEnabled&&$("#sidebarMainMenuBtn").prop("hidden",!1),Config.showSidebarForumListBtnEnabled&&$("#sidebarForumListBtn").prop("hidden",!1),Config.showSidebarSearchBtnEnabled&&$("#sidebarSearchBtn").prop("hidden",!1),Config.showSidebarHomePageBtnEnabled&&$("#sidebarHomePageBtn").prop("hidden",!1)},handleSidebarRollBtn=exports.handleSidebarRollBtn=function(){$(window).scroll(function(){var e=$("#sidebarRollBtn");if(640<$(window).scrollTop()){if("top"===e.data("direction"))return;e.data("direction","top").attr("aria-label","滚动到页顶").find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up")}else{if("bottom"===e.data("direction"))return;e.data("direction","bottom").attr("aria-label","滚动到页底").find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down")}}),$("#sidebarRollBtn").click(function(){var e="bottom"===$(this).data("direction")?$("body").height():0;$("body, html").animate({scrollTop:e})})},handleSearchDialog=exports.handleSearchDialog=function(){var t=$("#searchDialog");t.find('#searchType > option[value="username"]').prop("hidden",!Config.adminMemberEnabled),t.on("shown.bs.modal",function(){$("#searchKeyword").select().focus()}).find("form").submit(function(){var e=$(this),t=e.find("#searchKeyword"),n=e.find("#searchType").val(),a=$.trim(t.val());"gjc"===n?e.attr("action",Util.makeUrl("gjc/"+a)):"username"===n?e.attr("action",Util.makeUrl("user/username/"+a)):(e.attr("action",Util.makeUrl("search")),t.attr("name","author"===n?"pwuser":"keyword"),"title"===n&&a.length&&Util.getStrByteLen(a)<=2&&t.val(a+" "+a))}),t.find('[name="searchRange"]').on("click",function(){var e="all";"current"===$(this).val()&&(e=Info.fid),t.find('[name="f_fid"]').val(e)});var n=t.find('[name="searchRange"][value="current"]'),a=n.closest(".form-check-inline");t.find("#searchType").change(function(){var e=$(this).val();if(n.data("enabled")){var t="gjc"===e||"username"===e;n.prop("disabled",t),t?a.addClass("disabled"):a.removeClass("disabled")}}),"threadPage"!==pageId&&"readPage"!==pageId||(n.prop("disabled",!1).data("enabled",!0).click(),a.removeClass("disabled"))},handlePageInput=exports.handlePageInput=function(){$(document).on("click",".page-input",function(e){if(e.preventDefault(),!(Info.maxPageNum&&Info.maxPageNum<=1)){var t=$(this).data("url");if(t){var n=$(this).data("exclude");n=n?n.split(","):[];var a=parseInt(prompt("要跳转到第几页？"+(Info.maxPageNum?"（共"+Info.maxPageNum+"页）":""),Info.currentPageNum));a&&0<a&&(location.href=Util.makeUrl(t,"page="+a,!0,n))}}})},bindFastSubmitShortcutKey=exports.bindFastSubmitShortcutKey=function(){$('[data-fast-submit="true"]').keydown(function(e){13===e.keyCode&&e.ctrlKey&&$(this).closest("form").submit()})},showEditCommonForumDialog=exports.showEditCommonForumDialog=function(){$(document).on("click",".edit-common-forum-btn",function(e){e.preventDefault();var t="editCommonForumDialog";if(!(0<$("#"+t).length)){(0,_config.read)();var a=0<Config.commonForumList.length?Config.commonForumList:_const2.default.commonForumList,n="",o=!0,i=!1,r=void 0;try{for(var l,s=a[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=l.value;n+='<span class="btn btn-outline-primary" data-fid="'+c.fid+'">'+c.name+"</span>"}}catch(e){i=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw r}}var d="",u=!0,f=!1,p=void 0;try{for(var m,g=function(){var e=m.value,t=e.fid,n=e.name;if(a.find(function(e){return e.fid===t}))return"continue";d+='<span class="btn btn-outline-primary" data-fid="'+t+'">'+n+"</span>"},h=_const2.default.availableForumList[Symbol.iterator]();!(u=(m=h.next()).done);u=!0)g()}catch(e){f=!0,p=e}finally{try{!u&&h.return&&h.return()}finally{if(f)throw p}}var b='\n<p class="font-size-sm text-muted">\n  请将可用版块内的版块按钮拖拽到常用版块内（或相反）\n</p>\n<fieldset class="fieldset mb-3 py-2">\n  <legend>常用版块</legend>\n  <div class="edit-forum-list d-flex flex-wrap" id="editCommonForumList">'+n+'</div>\n</fieldset>\n<fieldset class="fieldset mb-3 py-2">\n  <legend>可用版块</legend>\n  <div class="edit-forum-list d-flex flex-wrap" id="editAvailableForumList">'+d+"</div>\n</fieldset>",v=Dialog.create(t,"编辑常用版块",b,'\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>\n<button class="btn btn-danger" name="reset" type="button">重置</button>'),y=function(){dragula(v.find(".edit-forum-list").get(),{revertOnSpill:!0}).on("drag",function(){v.find(".dialog-body").css("overflow-y","hidden")}).on("drop",function(){v.find(".dialog-body").css("overflow-y","auto")}).on("cancel",function(){v.find(".dialog-body").css("overflow-y","auto")})},k=$('[name="dragulaScriptPath"]'),w=k.val();w?($.getScript(w,y),k.val("")):y(),v.submit(function(e){e.preventDefault(),Config.commonForumList=[],$("#editCommonForumList").children(".btn").each(function(){var e=$(this),t=parseInt(e.data("fid")),n=e.text().trim();t&&n&&Config.commonForumList.push({fid:t,name:n})}),(0,_config.write)(),alert("设置已保存"),Dialog.close(t),location.reload()}).find('[name="reset"]').click(function(){confirm("是否重置？")&&(Config.commonForumList=[],(0,_config.write)(),alert("设置已重置"),Dialog.close(t),location.reload())}),Dialog.show(t)}})},fillCommonForumPanel=exports.fillCommonForumPanel=function(){var e=0<Config.commonForumList.length?Config.commonForumList:_const2.default.commonForumList,t="",n=!0,a=!1,o=void 0;try{for(var i,r=e.entries()[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=_slicedToArray(i.value,2),s=l[0],c=l[1],d=c.fid,u=c.name;0!==s&&s%3!=0||(t+='<div class="row mb-3">'),t+='\n<div class="col-4">\n  <a class="btn btn-outline-primary btn-block" href="'+Util.makeUrl("thread")+"/"+d+'">'+u+"</a>\n</div>",s!==e.length-1&&s%3!=2||(t+="</div>")}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}$(".common-forum-panel").html(t)},preventCloseWindow=exports.preventCloseWindow=function(){window.addEventListener("beforeunload",function(e){if(0<$(".mask").length){var t="正在进行操作中，确定要关闭页面吗？";return e.returnValue=t}})},showCommonImportOrExportConfigDialog=exports.showCommonImportOrExportConfigDialog=function(e,n,t,a){var o="pdCommonImOrExConfigDialog";if(!(0<$("#"+o).length)){(0,_config.read)();var i=Dialog.create(o,"导入或导出"+e,'\n<p class="font-size-sm">\n  <b>导入设置：</b>将设置内容粘贴到文本框中并点击保存按钮即可<br>\n  <b>导出设置：</b>复制文本框里的内容并粘贴到别处即可\n</p>\n<div class="form-group">\n  <textarea class="form-control font-size-sm" name="commonConfig" rows="10" aria-label="设置内容" style="word-break: break-all;"></textarea>\n</div>','\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>');i.submit(function(e){if(e.preventDefault(),confirm("是否导入文本框中的设置？")){var t=$.trim(i.find('[name="commonConfig"]').val());if(t){try{t=JSON.parse(t)}catch(e){return void alert("设置有错误")}t&&$.type(t)===$.type(Config[n])?(Config[n]=t,(0,_config.write)(),alert("设置已导入"),Dialog.close(o),"function"==typeof a?a():location.reload()):alert("设置有错误")}}}),Dialog.show(o),i.find('[name="commonConfig"]').val(JSON.stringify(Config[n])).select().focus(),"function"==typeof t&&t(i)}},followUsers=exports.followUsers=function(){Config.followUserList.length&&("indexPage"===pageId&&Config.highlightFollowUserThreadInHPEnabled?$(".thread-link").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.data("author"),Config.followUserList)&&e.addClass("text-danger")}):"threadPage"===pageId?$(".thread-link").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.data("author"),Config.followUserList)&&(e.closest(".thread-list-item").find(".thread-footer-column a:first").addClass("text-danger"),Config.highlightFollowUserThreadLinkEnabled&&e.addClass("text-danger"))}):"readPage"===pageId?$(".read-floor").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(Util.getFloorUserName(e.data("username")),Config.followUserList)&&e.find(".floor-num").addClass("text-danger")}):"gjcPage"!==pageId&&"sharePage"!==pageId&&"searchPage"!==pageId||$(".thread-list-group").find("a[data-author]").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.data("author"),Config.followUserList)&&e.addClass("text-danger")}))},blockUsers=exports.blockUsers=function(){if(Config.blockUserList.length){var a=0;if("indexPage"===pageId)$(".thread-link").each(function(){var e=$(this),t=Util.inFollowOrBlockUserList(e.data("author"),Config.blockUserList);-1<t&&Config.blockUserList[t].type<=1&&(a++,e.closest(".thread-link-group").remove())});else if("threadPage"===pageId){if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(Info.fid))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(Info.fid))return;$(".thread-link").each(function(){var e=$(this),t=Util.inFollowOrBlockUserList(e.data("author"),Config.blockUserList);-1<t&&Config.blockUserList[t].type<=1&&(a++,e.closest(".thread-list-item").remove())})}else if("readPage"===pageId){if(1===Config.blockUserForumType&&!Config.blockUserFidList.includes(Info.fid))return;if(2===Config.blockUserForumType&&Config.blockUserFidList.includes(Info.fid))return;$(".read-floor").each(function(){var e=$(this),t=Util.inFollowOrBlockUserList(Util.getFloorUserName(e.data("username")),Config.blockUserList);if(-1<t){var n=parseInt(e.data("floor"));if(2===Config.blockUserList[t].type&&0===n)return;if(1===Config.blockUserList[t].type&&0<n)return;a++,e.closest(".read-floor").remove()}}),$(".read-content").find(".blockquote > p").each(function(){var e=$(this),t=e.text().trim(),n=!0,a=!1,o=void 0;try{for(var i,r=Config.blockUserList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(1!==l.type)try{var s=new RegExp("^引用(第\\d+楼|楼主)"+l.name+"于","i"),c=new RegExp("^回\\s*\\d+楼\\("+l.name+"\\)\\s*的帖子","i");(s.test(t)||c.test(t))&&e.html('<mark class="help" data-toggle="tooltip" title="被屏蔽用户：'+l.name+'">该用户已被屏蔽</mark>')}catch(e){}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}})}else"gjcPage"===pageId&&Config.blockUserAtTipsEnabled&&$(".thread-list-group").find("a[data-author]").each(function(){var e=$(this);-1<Util.inFollowOrBlockUserList(e.data("author"),Config.blockUserList)&&(a++,e.closest(".thread-list-item").remove())});0<a&&console.log("【屏蔽用户】共有"+a+"个主题或回复被屏蔽")}},blockThread=exports.blockThread=function blockThread(){if(Config.blockThreadList.length){var isBlock=function isBlock(title,userName){var fid=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _iterator5=Config.blockThreadList[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var _step5$value=_step5.value,keyWord=_step5$value.keyWord,includeUser=_step5$value.includeUser,excludeUser=_step5$value.excludeUser,includeFid=_step5$value.includeFid,excludeFid=_step5$value.excludeFid,regex=null;if(/^\/.+\/[gimuy]*$/.test(keyWord))try{regex=eval(keyWord)}catch(e){console.log(e);continue}if(userName)if(includeUser){if(!includeUser.includes(userName))continue}else if(excludeUser&&excludeUser.includes(userName))continue;if(fid)if(includeFid){if(!includeFid.includes(fid))continue}else if(excludeFid&&excludeFid.includes(fid))continue;if(regex){if(regex.test(title))return!0}else if(title.toLowerCase().includes(keyWord.toLowerCase()))return!0}}catch(e){_didIteratorError5=!0,_iteratorError5=e}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}return!1},num=0;if("indexPage"===pageId)$(".thread-link").each(function(){var e=$(this);isBlock(e.text().trim(),e.data("author"))&&(num++,e.closest(".thread-link-group").remove())});else if("threadPage"===pageId)$(".thread-link").each(function(){var e=$(this);isBlock(e.attr("title"),e.data("author"),Info.fid)&&(num++,e.closest(".thread-list-item").remove())});else if("readPage"===pageId){if(1!==Info.currentPageNum)return;var $topFloor=$('.read-floor[data-floor="0"]');if(!$topFloor.length)return;isBlock($(".thread-title").text().trim(),Util.getFloorUserName($topFloor.data("username")),Info.fid)&&(num++,$topFloor.remove())}0<num&&console.log("【屏蔽主题】共有"+num+"个主题被屏蔽")}}},{"./config":2,"./configDialog":3,"./const":4,"./dialog":5,"./util":13}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleMoveThreadBtn=n.replaceAttachLabel=n.addUserMemo=n.bindMultiQuoteCheckClick=n.handleCopyCodeBtn=n.handleTuiThreadBtn=n.handleFastGotoFloorBtn=n.gotoFloor=n.handleFloorImage=n.copyBuyThreadList=n.handleBuyThreadBtn=n.handleBlockFloorBtn=n.handleGoodPostBtn=n.handleFastReplyBtn=n.handleCopyFloorLinkBtn=void 0;var a,r=s(e("./util")),o=e("./const"),i=(a=o)&&a.__esModule?a:{default:a},l=(e("./config"),s(e("./msg")));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}n.handleCopyFloorLinkBtn=function(){$(document).on("click",".floor-num",function(e){e.preventDefault();var t=$(this),n=r.getHostNameUrl()+t.attr("href");t.data("copy-text",n),r.copyText(t,t)||prompt("本楼的跳转链接：",n)})},n.handleFastReplyBtn=function(){$(document).on("click",".fast-reply-btn",function(){var e=$(this).closest("article"),t=e.data("floor"),n=r.getFloorUserName(e.data("username"));$("#postGjc").val(n);var a=$("#postContent").get(0);a.value="[quote]回 "+t+"楼("+n+") 的帖子[/quote]\n",a.selectionStart=a.value.length,a.selectionEnd=a.value.length,a.focus()})},n.handleGoodPostBtn=function(){$(document).on("click",".handle-post-btn",function(){var e=$(this);if(!e.data("wait")){var n=$(this).closest(".read-floor"),t=n.data("pid"),a="是否提交本楼层为优秀帖子？";Info.goodPostTips&&(a+="\n（"+Info.goodPostTips+"）"),confirm(a)&&(e.data("wait",!0),$.post("/diy_read_cztz.php","tid="+Info.tid+"&pid="+t+"&safeid="+Info.safeId).done(function(e){if(/已将本帖操作为优秀帖|该楼层已经是优秀帖/.test(e)){var t=n.find(".read-content");t.find('.fieldset-alert:contains("本帖为优秀帖")').length||t.prepend('<fieldset class="fieldset fieldset-alert"><legend>↓</legend>本帖为优秀帖</fieldset>')}alert(e)}).always(function(){return e.removeData("wait")}))}})},n.handleBlockFloorBtn=function(){$(document).on("click",".block-floor",function(){return confirm("确认要屏蔽该回帖？本操作不可恢复！（屏蔽后该回帖将对大家不可见）")})},n.handleBuyThreadBtn=function(){$(document).on("click",".buy-thread-btn",function(e){e.preventDefault();var t=$(this),n=t.data("pid"),a=t.data("price");if(!(5<a)||confirm("此贴售价"+a+"KFB，是否购买？")){var o=l.wait("正在购买帖子&hellip;");$.get(r.makeUrl("job/buytopic","tid="+Info.tid+"&pid="+n+"&verify="+Info.verify+"&t="+(new Date).getTime()),function(e){var t=e.msg;l.remove(o),"操作完成"===t?location.reload():t.includes("您已经购买此帖")?(alert("你已经购买过此帖"),location.reload()):alert("帖子购买失败")})}})},n.copyBuyThreadList=function(){$(document).on("change",".buy-thread-list",function(){var e=$(this);if("copyList"===e.val()){var t=e.find("option").map(function(e){var t=$(this).text();return 0===e||1===e||t.includes("-".repeat(11))?null:t}).get().join("\n");if(e.get(0).selectedIndex=0,t){var n=$('\n<div class="modal fade" id="buyThreadListDialog" tabindex="-1" role="dialog" aria-labelledby="buyThreadListDialogTitle"\n     aria-hidden="true">\n  <div class="modal-dialog modal-sm" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="buyThreadListDialogTitle">购买人名单</h5>\n        <button class="close" data-dismiss="modal" type="button" aria-label="关闭">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <textarea class="form-control" name="buyThreadListContent" rows="14" aria-label="购买人名单">'+t+"</textarea>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n").appendTo("body");n.on("shown.bs.modal",function(){n.find('[name="buyThreadListContent"]').select().focus()}).on("hidden.bs.modal",function(){n.remove()}).modal("show")}else alert("暂时无人购买")}})},n.handleFloorImage=function(){$(document).on("click",".img",function(){var e=$(this);e.parent().is("a")||this.naturalWidth<=e.closest(".read-content").width()||(location.href=e.attr("src"))})},n.gotoFloor=function(){if(Info.floor&&0<Info.floor){var e=$('article[data-floor="'+Info.floor+'"]').prev("a").attr("name");e&&(location.hash="#"+e)}},n.handleFastGotoFloorBtn=function(){$(".fast-goto-floor").click(function(e){e.preventDefault();var t=$(this).data("url");if(t){var n=parseInt(prompt("你要跳转到哪一层楼？"));!n||n<=0||(location.href=r.makeUrl(t,"page="+(Math.floor(n/Config.perPageFloorNum)+1)+"&floor="+n))}})},n.handleTuiThreadBtn=function(){$(".tui-btn").click(function(e){e.preventDefault();var a=$(this);a.data("wait")||(a.data("wait",!0),$.ajax({type:"POST",url:"/diy_read_tui.php",data:"tid="+Info.tid+"&safeid="+Info.safeId,success:function(e){var t=/<span.+?\+\d+!<\/span>\s*(\d+)/i.exec(e);if(t){var n=a.find("span:first");n.text("+1"),setTimeout(function(){n.text(t[1])},1e3)}else/已推过/.test(e)?alert("已推过"):alert("操作失败")},error:function(){alert("操作失败")},complete:function(){a.removeData("wait")}}))})},n.handleCopyCodeBtn=function(){$(document).on("click",".copy-code",function(e){e.preventDefault();var t=$(this);if(!r.copyText(t.next("pre"),t)){var n=t.data("code");if(n)t.text("复制代码").removeData("code"),t.next("textarea").remove(),t.after('<pre class="pre-scrollable">'+n+"</pre>");else{var a=t.next("pre"),o=a.html();t.text("还原代码").data("code",o),o=r.decodeHtmlSpecialChar(o);var i=a.height();i<50&&(i=50),340<i&&(i=340),a.remove(),$('<textarea class="form-control code-textarea" style="height: '+i+'px" wrap="off">'+o+"</textarea>").insertAfter(t).select().focus()}}})},n.bindMultiQuoteCheckClick=function(){$(document).on("click",".multi-quote-check",function(){var t=localStorage[i.default.multiQuoteStorageName];if(t)try{!(t=JSON.parse(t))||"object"!==$.type(t)||$.isEmptyObject(t)?t=null:"tid"in t&&t.tid===Info.tid&&"object"===$.type(t.quoteList)||(t=null)}catch(e){t=null}else t=null;var e=function(){var t=[];return $(".multi-quote-check:checked").each(function(){var e=$(this).closest("article");t.push({floor:e.data("floor"),pid:e.data("pid"),userName:r.getFloorUserName(e.data("username"))})}),t}();t||(localStorage.removeItem(i.default.multiQuoteStorageName),t={tid:Info.tid,quoteList:{}}),0<e.length?t.quoteList[Info.currentPageNum]=e:delete t.quoteList[Info.currentPageNum],localStorage[i.default.multiQuoteStorageName]=JSON.stringify(t)})},n.addUserMemo=function(){$.isEmptyObject(Config.userMemoList)||$(".read-floor").each(function(){var e=$(this),t=r.getFloorUserName(e.data("username")),n=Object.keys(Config.userMemoList).find(function(e){return e===t});n&&e.find(".floor-user").after('<span class="tips font-size-sm" data-toggle="tooltip" title="备注：'+Config.userMemoList[n]+'">[?]</span>')})},n.replaceAttachLabel=function(){$(".attach-label").each(function(){var e=$(this);if(!(0<e.closest(".blockquote").length)){var t=e.data("aid"),n=e.closest(".read-floor").data("pid");e.replaceWith('<img class="img" src="/job.php?action=download&pid='+n+"&tid="+Info.tid+"&aid="+t+'" alt="[附件图片]">')}})},n.handleMoveThreadBtn=function(){$("#moveThreadBtn").click(function(e){e.preventDefault(),confirm("是否将该主题移到[无限制资源区]？")&&$.post("/diy_admin_read.php","tid="+Info.tid+"&safeid="+Info.safeId,function(e){alert(e),location.reload()})})}},{"./config":2,"./const":4,"./msg":7,"./util":13}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleInstallScriptLink=exports.showDialog=exports.getScriptMeta=exports.runCustomScript=exports.runCmd=void 0;var _util=require("./util"),Util=_interopRequireWildcard(_util),_dialog=require("./dialog"),Dialog=_interopRequireWildcard(_dialog),_config=require("./config");function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var defScriptName="未命名脚本",metaRegex=/\/\/\s*==UserScript==((?:.|\n)+?)\/\/\s*==\/UserScript==/i,runCmd=exports.runCmd=function runCmd(cmd){var isOutput=1<arguments.length&&void 0!==arguments[1]&&arguments[1],isError=!1,response="";try{response=eval(cmd),isOutput&&console.log(response)}catch(e){isError=!0,response=e,console.log(e)}return{isError:isError,response:String(response)}},runCustomScript=exports.runCustomScript=function(e){var t=0<arguments.length&&void 0!==e?e:"end",n=!0,a=!1,o=void 0;try{for(var i,r=Config.customScriptList[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value,s=l.enabled,c=l.trigger,d=l.content;s&&c===t&&d&&runCmd(d)}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}},getScriptMeta=exports.getScriptMeta=function(e){var t={name:defScriptName,version:"",trigger:"end",homepage:"",author:""},n=metaRegex.exec(e);if(!n)return t;var a=n[1];return(n=/@name[ \t]+(.*)/i.exec(a))&&(t.name=n[1]),(n=/@version[ \t]+(.*)/i.exec(a))&&(t.version=n[1]),(n=/@trigger[ \t]+(.*)/i.exec(a))&&(t.trigger="start"===n[1].toLowerCase()?"start":"end"),(n=/@homepage[ \t]+(.*)/i.exec(a))&&(t.homepage=n[1]),(n=/@author[ \t]+(.*)/i.exec(a))&&(t.author=n[1]),t},showDialog=exports.showDialog=function(e){var t=0<arguments.length&&void 0!==e?e:null,n="customScriptDialog";if(!(0<$("#"+n).length)){(0,_config.read)();var a='\n<div class="d-flex mb-3">\n  <div class="btn-group btn-group-sm">\n    <button class="btn btn-success" name="add" type="button">添加脚本</button>\n    <button class="btn btn-secondary" name="insertSample" type="button">插入范例</button>\n  </div>\n  \n  <div class="btn-group btn-group-sm ml-auto">\n    <a class="btn btn-link" href="'+window.Info.rootPath+'read/682170/sf/6d7" target="_blank">脚本收集贴</a>\n  </div>\n</div>\n<div id="customScriptList"></div>\n',o=Dialog.create(n,"自定义脚本",a,'\n<button class="btn btn-warning mr-auto" name="openImOrExCustomScriptDialog" type="button">导入/导出</button>\n<button class="btn btn-primary" type="submit">保存</button>\n<button class="btn btn-secondary" data-dismiss="dialog" type="button">取消</button>\n<button class="btn btn-danger" name="clear" type="button">清空</button>'),g=o.find("#customScriptList");o.submit(function(e){e.preventDefault(),Config.customScriptList=[],g.find('textarea[name="customScriptContent"]').each(function(){var e=$(this),t=e.val();if($.trim(t)){var n=e.closest(".custom-script-container").find('[name="enabled"]').prop("checked");Config.customScriptList.push($.extend(getScriptMeta(t),{enabled:n,content:t}))}}),(0,_config.write)(),Dialog.close(n),alert("自定义脚本修改成功\n（需刷新页面后才可生效）")}).end().find('[name="clear"]').click(function(){confirm("是否清空所有脚本？")&&(g.html(""),Dialog.resize(n))});var i=function(e){var t=0<arguments.length&&void 0!==e?e:{},n=t.enabled,a=void 0===n||n,o=t.name,i=void 0===o?defScriptName:o,r=t.version,l=void 0===r?"":r,s=t.homepage,c=void 0===s?"":s,d=t.trigger,u=void 0===d?"end":d,f=t.content,p=void 0===f?"":f,m=g.find(".custom-script-container").length;g.append('\n<div class="card custom-script-container">\n  <div class="card-header d-flex p-1" id="customScriptHeader'+m+'">\n    <div class="form-check form-check-inline mx-1">\n      <input class="form-check-input position-static" name="enabled" type="checkbox" '+(a?"checked":"")+' title="是否启用" aria-label="是否启用">\n    </div>\n\n    <button class="btn btn-link btn-sm mx-1 px-0 text-truncate custom-script-name" data-toggle="collapse" data-target="#customScriptContent'+m+'" type="button"\n            title="'+i+'" aria-expanded="true" aria-controls="customScriptContent'+m+'">'+i+'</button>\n\n    <div class="ml-auto col-auto px-0">\n      <a class="badge badge-primary align-middle custom-script-homepage" '+(c?"":"hidden")+'\n         href="'+(c.startsWith("http")?"":Info.rootPath)+c+'" target="_blank">主页</a>\n      <span class="badge badge-warning align-middle custom-script-version" '+(l?"":"hidden")+">"+l+'</span>\n      <span class="badge badge-'+("start"===u?"danger":"info")+' align-middle custom-script-trigger" title="脚本执行时机">'+("start"===u?"开":"结")+'</span>\n      <button class="btn btn-link btn-sm text-danger" name="delete" type="button">删</button>\n    </div>\n  </div>\n\n  <div class="collapse custom-script-content" id="customScriptContent'+m+'" aria-labelledby="customScriptHeader'+m+'" data-parent="#customScriptList">\n    <div class="card-body p-0">\n      <textarea class="form-control border-0 font-size-sm font-monospace" name="customScriptContent" rows="12" style="white-space: pre;" wrap="off">'+p+"</textarea>\n    </div>\n  </div>\n</div>\n")};o.find('[name="add"]').click(function(){g.find(".custom-script-content.show").collapse(),i(),g.find(".custom-script-content:last").collapse()}).end().find('[name="insertSample"]').click(function(){var e=g.find('.custom-script-content.show textarea[name="customScriptContent"]');e.val(("\n// ==UserScript==\n// @name        "+defScriptName+"\n// @version     1.0\n// @author      "+Info.userName+"\n// @trigger     end\n// @homepage    read/682170/spid/14034074/sf/6d7\n// @description 这是一个未命名脚本\n// ==/UserScript==\n").trim()+"\n"+e.val()).focus()}).end().find('[name="openImOrExCustomScriptDialog"]').click(function(){Public.showCommonImportOrExportConfigDialog("自定义脚本","customScriptList")}),g.on("click",'[name="delete"]',function(){confirm("是否删除此脚本？")&&$(this).closest(".custom-script-container").remove()}).on("change",'textarea[name="customScriptContent"]',function(){var e=$(this),t=getScriptMeta(e.val()),n=t.name,a=t.version,o=t.homepage,i=t.trigger,r=e.closest(".custom-script-container");r.find(".custom-script-name").text(n||defScriptName),r.find(".custom-script-homepage").attr("href",o||"").prop("hidden",!o),r.find(".custom-script-version").text(a).prop("hidden",!a),r.find(".custom-script-trigger").text("start"===i?"开":"结").removeClass("badge-"+("start"===i?"info":"danger")).addClass("badge-"+("start"===i?"danger":"info"))});var r=!0,l=!1,s=void 0;try{for(var c,d=Config.customScriptList[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var u=c.value;i(u)}}catch(e){l=!0,s=e}finally{try{!r&&d.return&&d.return()}finally{if(l)throw s}}Dialog.show(n),"number"==typeof t&&g.find("#customScriptContent"+t).collapse()}},handleInstallScriptLink=exports.handleInstallScriptLink=function(){$("main").on("click",'a[href$="#install-mobile-script"]',function(e){e.preventDefault();var t=$(this).nextAll(".code-area").eq(0).find("pre");if(t.length){var n=Util.htmlDecode(t.html().replace(/<legend>.+?<\/legend>/i,"")).trim();if(metaRegex.test(n)){(0,_config.read)();var a=getScriptMeta(n),o=Config.customScriptList.findIndex(function(e){return e.name===a.name&&e.author===a.author}),i=-1<o;if(confirm("是否"+(i?"更新":"安装")+"此脚本？")){Config.customScriptEnabled=!0;var r=$.extend(a,{enabled:!0,content:n});i?Config.customScriptList[o]=r:Config.customScriptList.push(r),(0,_config.write)(),Dialog.close("customScriptDialog"),showDialog(o)}}}}).on("click",'a[href$="#install-script"]',function(e){e.preventDefault(),alert("无法安装适用于电脑版论坛的自定义脚本")})}},{"./config":2,"./dialog":5,"./util":13}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function d(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}n.setCookie=function(e,t,n,a){var o=2<arguments.length&&void 0!==n?n:null,i=3<arguments.length&&void 0!==a?a:Info.uid+"_"+Const.storagePrefix;document.cookie=""+i+e+"="+encodeURI(t)+(o?";expires="+o.toUTCString():"")+";path=/;"},n.getCookie=function(e,t){var n=1<arguments.length&&void 0!==t?t:Info.uid+"_"+Const.storagePrefix,a=new RegExp("(^| )"+n+e+"=([^;]*)(;|$)"),o=document.cookie.match(a);return o?decodeURI(o[2]):null},n.deleteCookie=function(e,t){var n=1<arguments.length&&void 0!==t?t:Info.uid+"_"+Const.storagePrefix;document.cookie=""+n+e+"=;expires="+a("-1d").toUTCString()+";path=/;"};var a=n.getDate=function(e){var t=new Date,n=/^(-|\+)?(\d+)([a-zA-Z]{1,2})$/.exec(e);if(!n)return null;var a=void 0===n[1]?0:"+"===n[1]?1:-1,o=-1==a?-parseInt(n[2]):parseInt(n[2]);switch(n[3]){case"Y":t.setFullYear(o);break;case"y":t.setFullYear(0==a?o:t.getFullYear()+o);break;case"M":t.setMonth(0==a?o:t.getMonth()+o);break;case"d":t.setDate(0==a?o:t.getDate()+o);break;case"h":t.setHours(0==a?o:t.getHours()+o);break;case"m":t.setMinutes(0==a?o:t.getMinutes()+o);break;case"s":t.setSeconds(0==a?o:t.getSeconds()+o);break;case"ms":t.setMilliseconds(0==a?o:t.getMilliseconds()+o);break;default:return null}return t},u=(n.getStrByteLen=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n)<0||255<e.charCodeAt(n)?2:1;return t},n.getHostNameUrl=function(){return location.protocol+"//"+location.host},n.addCode=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:"",o=""===a?t.indexOf("]")+1:t.indexOf(a);if(void 0!==e.selectionStart){var i=e.selectionStart;e.value=e.value.substring(0,i)+t+e.value.substring(e.selectionEnd),e.selectionStart=i+o,e.selectionEnd=i+o+a.length}else e.value+=t},n.getSelText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},n.extractQueryStr=function(e){var t=new Map,n=!0,a=!1,o=void 0;try{for(var i,r=e.split("&")[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=i.value;if(l){var s=l.split("="),c=f(s,2),d=c[0],u=c[1];t.set(d,void 0!==u?u:"")}}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return t}),p=n.buildQueryStr=function(e){var t="",n=!0,a=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var l=f(i.value,2),s=l[0],c=l[1];2===Info.urlType?t+=(t?"&":"")+s+"="+c:t+=(t?"/":"")+s+"/"+c}}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return t},o=(n.makeUrl=function(e,t,n,a){var o=2<arguments.length&&void 0!==n&&n,i=3<arguments.length&&void 0!==a?a:[],r="",l=u(1<arguments.length&&void 0!==t?t:"");if(o)for(var s in l=new Map([].concat(d(u(Info.urlParam).entries()),d(l.entries()))),i)l.delete(i[s]);if(e.startsWith("/")||(r=location.pathname.startsWith(Info.baseFile)?Info.baseFile+"/":Info.rootPath),r+=e,0<l.size){var c=p(l);c&&(r+=(2===Info.urlType?"?":"/")+c)}return r},n.getQueryParam=function(e){return u(Info.urlParam).get(e)},n.decodeHtmlSpecialChar=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.removeHtmlTag=function(e){return e?e.replace(/<br\s*\/?>/g,"\n").replace(/<[^>]+>/g,""):""},n.selectAll=function(e){e.prop("checked",!0)},n.selectInverse=function(e){e.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))})},n.showValidationMsg=function(e,t,n){var a=2<arguments.length&&void 0!==n?n:"";"error"===t&&(t="danger"),e.removeClass("form-control-success form-control-warning form-control-danger");var o=e.parent();o.removeClass("has-success has-warning has-danger"),$.inArray(t,-1<["success","warning","danger"])&&e.addClass("form-control-"+t).parent().addClass("has-"+t);var i=o.find(".form-control-feedback");"wait"===t?i.html('<span class="text-muted"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> '+a+"</span>"):i.text(a)},n.getDifferenceSetOfObject=function(n,e){var a={};return"object"!==$.type(n)||"object"!==$.type(e)||$.each(e,function(e,t){e in n&&(o(n[e],t)||(a[e]=t))}),a},n.deepEqual=function e(t,n){if(t===n)return!0;if($.type(t)!==$.type(n))return!1;if("number"==typeof t&&"number"==typeof n&&isNaN(t)&&isNaN(n))return!0;if($.isArray(t)&&$.isArray(n)||"object"===$.type(t)&&"object"===$.type(n)){if(t.length!==n.length)return!1;for(var a in $.extend($.isArray(t)?[]:{},t,n)){if(void 0===t[a]||void 0===n[a])return!1;if(!e(t[a],n[a]))return!1}return!0}return!1});n.copyText=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!("execCommand"in document&&e.length))return!1;var n=e.data("copy-text");n&&(e=$('<span class="text-hide">'+n+"</span>").insertAfter(e));var a=window.getSelection();a.selectAllChildren(e.get(0));var o=document.execCommand("copy");if(a.removeAllRanges(),n&&e.remove(),o&&t){var i=t.data("copy-msg");t.attr("title",i||"已复制").on("hidden.bs.tooltip",function(){$(this).tooltip("dispose")}).tooltip("show")}return o},n.inFollowOrBlockUserList=function(t,e){return e.findIndex(function(e){return e.name&&e.name==t})},n.isOpera=function(){return void 0!==window.opera},n.isEdge=function(){return navigator.appVersion&&navigator.appVersion.includes("Edge")},n.htmlEncode=function(e){return e.length?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>"):""},n.htmlDecode=function(e){return e.length?e.replace(/<br\s*\/?>/gi,"\n").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'").replace(/&nbsp;/gi," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&amp;/gi,"&"):""},n.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=Info.urlParam.match(t);return n?decodeURI(n[2]):null},n.removeUnpairedBBCodeContent=function(e){for(var t=[/\[color=.+?\]/g,/\[backcolor=.+?\]/g,/\[size=.+?\]/g,/\[font=.+?\]/g,/\[align=.+?\]/g,/\[b\]/g,/\[i\]/g,/\[u\]/g,/\[strike\]/g,/\[sup\]/g,/\[sub\]/g],n=[/\[\/color\]/g,/\[\/backcolor\]/g,/\[\/size\]/g,/\[\/font\]/g,/\[\/align\]/g,/\[\/b\]/g,/\[\/i\]/g,/\[\/u\]/g,/\[\/strike\]/g,/\[\/sup\]/g,/\[\/sub\]/g],a=0;a<t.length;a++){var o=e.match(t[a]),i=e.match(n[a]);(o?o.length:0)!==(i?i.length:0)&&(e=e.replace(t[a],"").replace(n[a],""))}return e},n.getFloorUserName=function(e){if((e=$.trim(e)).includes(" ")){var t=e.split(" ");return 2===t.length?t[1]:e}return e}},{}]},{},[1]);
//# sourceMappingURL=app.min.js.map
